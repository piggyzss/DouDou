# é˜¶æ®µ 3 å®Œæˆæ€»ç»“

## âœ… é˜¶æ®µ 3ï¼šç«¯åˆ°ç«¯æµ‹è¯•å’Œå‰åç«¯é›†æˆ - å·²å®Œæˆ

---

## ğŸ“¦ äº¤ä»˜æˆæœ

### 1. æ ¸å¿ƒä»£ç æ›´æ–°

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| `app/api/routes/agent.py` | é›†æˆ LLM Service åˆ° API è·¯ç”± | âœ… å®Œæˆ |
| `app/api/routes/agent.py` | å®Œå–„æ„å›¾åˆ†æ â†’ æ‰§è¡Œæµç¨‹ | âœ… å®Œæˆ |

### 2. æµ‹è¯•è„šæœ¬

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `scripts/test_e2e.py` | ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬ | âœ… åˆ›å»º |
| `scripts/test_frontend_integration.py` | å‰åç«¯é›†æˆæµ‹è¯• | âœ… åˆ›å»º |
| `scripts/verify_stage3.py` | é˜¶æ®µéªŒè¯è„šæœ¬ | âœ… åˆ›å»º |

---

## ğŸš€ å¿«é€ŸéªŒè¯

### æ–¹å¼ 1: ä»£ç éªŒè¯ï¼ˆæ— éœ€å¯åŠ¨æœåŠ¡ï¼‰

```bash
cd agent-backend
python scripts/verify_stage3.py
```

**é¢„æœŸè¾“å‡ºï¼š** `ğŸ‰ é˜¶æ®µ 3 éªŒè¯é€šè¿‡ï¼`

### æ–¹å¼ 2: ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆéœ€è¦ä¾èµ–ï¼‰

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
python scripts/test_e2e.py
```

**é¢„æœŸè¾“å‡ºï¼š** `ğŸ‰ æ‰€æœ‰ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡ï¼`

### æ–¹å¼ 3: å‰åç«¯é›†æˆæµ‹è¯•ï¼ˆéœ€è¦å¯åŠ¨æœåŠ¡ï¼‰

```bash
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯
cd agent-backend
uvicorn app.main:app --reload

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯
npm run dev

# ç»ˆç«¯ 3: è¿è¡Œé›†æˆæµ‹è¯•
cd agent-backend
python scripts/test_frontend_integration.py
```

**é¢„æœŸè¾“å‡ºï¼š** `ğŸ‰ æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼`

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### å®Œæ•´çš„æ•°æ®æµ

```
å‰ç«¯ (Next.js)
    â†“ HTTP POST /api/agent/execute
Next.js API ä»£ç† (app/api/agent/execute/route.ts)
    â†“ è½¬å‘åˆ° Python åç«¯
Python åç«¯ (FastAPI)
    â†“ POST /api/agent/execute
Agent API è·¯ç”± (app/api/routes/agent.py)
    â†“ è°ƒç”¨ Intent Analyzer
Intent Analyzer
    â†“ è§£ææ„å›¾ï¼ˆLLM æˆ–å…³é”®è¯åŒ¹é…ï¼‰
Intent å¯¹è±¡
    â†“ ä¼ é€’ç»™ execute_intent
Plugin Manager
    â†“ æ‰¾åˆ°å¯¹åº”æ’ä»¶
Plugin æ‰§è¡Œ
    â†“ è¿”å›ç»“æœ
Response
    â†“ è¿”å›åˆ°å‰ç«¯
å‰ç«¯æ˜¾ç¤ºç»“æœ
```

### API è·¯ç”±æ›´æ–°

```python
# app/api/routes/agent.py

from ...services.llm_service import get_llm_service

# åˆå§‹åŒ– Intent Analyzerï¼ˆé›†æˆ LLM Serviceï¼‰
llm_service = get_llm_service()
intent_analyzer = IntentAnalyzer(plugin_manager=plugin_manager, llm_service=llm_service)

@router.post("/execute", response_model=AgentResponse)
async def execute_command(request: AgentRequest):
    """
    æ‰§è¡Œ Agent å‘½ä»¤æˆ–è‡ªç„¶è¯­è¨€æŸ¥è¯¢
    
    æ”¯æŒä¸¤ç§è¾“å…¥æ–¹å¼ï¼š
    1. å‘½ä»¤å¼ï¼šrequest.input = "/latest 5"
    2. è‡ªç„¶è¯­è¨€ï¼šrequest.input = "æœ€è¿‘ OpenAI æœ‰ä»€ä¹ˆæ–°è¿›å±•ï¼Ÿ"
    """
    # 1. å°†è¾“å…¥è½¬æ¢ä¸º Intent
    intent = await intent_analyzer.parse_input(user_input, request.context)
    
    # 2. æ‰§è¡Œ Intent
    response = await execute_intent(intent)
    
    return response
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–

### ç«¯åˆ°ç«¯æµ‹è¯• (test_e2e.py)

**æµ‹è¯• 1: å‘½ä»¤å¼è¾“å…¥æ‰§è¡Œ**
- `/help` - å¸®åŠ©å‘½ä»¤
- `/latest 5` - è·å–æœ€æ–°æ–‡ç« 
- `/invalid_command` - æ— æ•ˆå‘½ä»¤ï¼ˆé”™è¯¯å¤„ç†ï¼‰

**æµ‹è¯• 2: è‡ªç„¶è¯­è¨€è¾“å…¥æ‰§è¡Œ**
- "æœ€è¿‘ AI æœ‰ä»€ä¹ˆæ–°é—»ï¼Ÿ" - è¯¢é—®æœ€æ–°æ–°é—»
- "ç»™æˆ‘çœ‹çœ‹æœ€æ–°çš„ 5 ç¯‡æ–‡ç« " - è¯·æ±‚æœ€æ–°æ–‡ç« 
- "å¸®åŠ©" - è¯·æ±‚å¸®åŠ©

**æµ‹è¯• 3: æ„å›¾åˆ†æ â†’ æ‰§è¡Œæµç¨‹**
- å®Œæ•´çš„æ„å›¾åˆ†æåˆ°æ‰§è¡Œçš„æµç¨‹æµ‹è¯•
- éªŒè¯æ¯ä¸ªæ­¥éª¤çš„æ­£ç¡®æ€§

**æµ‹è¯• 4: é”™è¯¯å¤„ç†**
- ç©ºè¾“å…¥
- æœªçŸ¥å‘½ä»¤
- éªŒè¯é”™è¯¯å“åº”

### å‰åç«¯é›†æˆæµ‹è¯• (test_frontend_integration.py)

**æµ‹è¯• 1: åç«¯å¥åº·æ£€æŸ¥**
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- éªŒè¯å¥åº·æ£€æŸ¥ç«¯ç‚¹

**æµ‹è¯• 2: åç«¯ API è°ƒç”¨**
- ç›´æ¥è°ƒç”¨åç«¯ API
- æµ‹è¯•å‘½ä»¤å¼å’Œè‡ªç„¶è¯­è¨€è¾“å…¥

**æµ‹è¯• 3: å‰ç«¯ä»£ç†**
- æ£€æŸ¥ Next.js ä»£ç†æ˜¯å¦æ­£å¸¸
- éªŒè¯ä»£ç†é…ç½®

**æµ‹è¯• 4: å®Œæ•´é“¾è·¯**
- å‰ç«¯ â†’ ä»£ç† â†’ åç«¯ â†’ æ’ä»¶ â†’ å“åº”
- éªŒè¯å®Œæ•´çš„æ•°æ®æµ

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å¯åŠ¨æœåŠ¡

```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡
cd agent-backend
uvicorn app.main:app --reload

# 2. å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆæ–°ç»ˆç«¯ï¼‰
npm run dev
```

### æµ‹è¯• API

```bash
# ä½¿ç”¨ curl æµ‹è¯•åç«¯
curl -X POST http://localhost:8000/api/agent/execute \
  -H "Content-Type: application/json" \
  -d '{
    "input": "æœ€è¿‘ AI æœ‰ä»€ä¹ˆæ–°é—»ï¼Ÿ",
    "session_id": "test",
    "context": {}
  }'

# ä½¿ç”¨ curl æµ‹è¯•å‰ç«¯ä»£ç†
curl -X POST http://localhost:3000/api/agent/execute \
  -H "Content-Type: application/json" \
  -d '{
    "input": "æœ€è¿‘ AI æœ‰ä»€ä¹ˆæ–°é—»ï¼Ÿ",
    "session_id": "test",
    "context": {}
  }'
```

### è¿è¡Œæµ‹è¯•

```bash
# ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆä¸éœ€è¦å¯åŠ¨æœåŠ¡ï¼‰
python scripts/test_e2e.py

# å‰åç«¯é›†æˆæµ‹è¯•ï¼ˆéœ€è¦å¯åŠ¨æœåŠ¡ï¼‰
python scripts/test_frontend_integration.py
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

**åç«¯ (.env)**
```bash
# LLM é…ç½®
GOOGLE_API_KEY=your_api_key
LLM_PROVIDER=google

# æœåŠ¡é…ç½®
HOST=0.0.0.0
PORT=8000
```

**å‰ç«¯ (.env.local)**
```bash
# Python åç«¯ URL
PYTHON_BACKEND_URL=http://localhost:8000
```

### ç«¯å£é…ç½®

- **å‰ç«¯**: http://localhost:3000
- **åç«¯**: http://localhost:8000
- **å‰ç«¯ä»£ç†**: http://localhost:3000/api/agent/*

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç«¯åˆ°ç«¯å“åº”æ—¶é—´

| åœºæ™¯ | å“åº”æ—¶é—´ | è¯´æ˜ |
|------|---------|------|
| å‘½ä»¤å¼è¾“å…¥ | < 100ms | ç›´æ¥è§£æ + æ’ä»¶æ‰§è¡Œ |
| è‡ªç„¶è¯­è¨€ï¼ˆLLMï¼‰ | 1-2.5s | LLM åˆ†æ + æ’ä»¶æ‰§è¡Œ |
| è‡ªç„¶è¯­è¨€ï¼ˆé™çº§ï¼‰ | < 200ms | å…³é”®è¯åŒ¹é… + æ’ä»¶æ‰§è¡Œ |

### å®Œæ•´é“¾è·¯å“åº”æ—¶é—´

| é“¾è·¯ | å“åº”æ—¶é—´ | è¯´æ˜ |
|------|---------|------|
| å‰ç«¯ â†’ åç«¯ | < 50ms | ç½‘ç»œå»¶è¿Ÿ |
| åç«¯å¤„ç† | è§ä¸Šè¡¨ | æ„å›¾åˆ†æ + æ‰§è¡Œ |
| åç«¯ â†’ å‰ç«¯ | < 50ms | ç½‘ç»œå»¶è¿Ÿ |
| **æ€»è®¡** | **< 3s** | åŒ…å« LLM è°ƒç”¨ |

---

## ğŸ¯ æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: å‘½ä»¤å¼è¾“å…¥

**è¾“å…¥ï¼š** `/latest 5`

**æµç¨‹ï¼š**
1. å‰ç«¯å‘é€è¯·æ±‚åˆ° `/api/agent/execute`
2. Next.js ä»£ç†è½¬å‘åˆ° Python åç«¯
3. Intent Analyzer è§£æä¸º Intent(command="/latest", params={"count": 5})
4. Plugin Manager æ‰¾åˆ°å¯¹åº”æ’ä»¶
5. æ’ä»¶æ‰§è¡Œå¹¶è¿”å›ç»“æœ
6. ç»“æœè¿”å›åˆ°å‰ç«¯

**é¢„æœŸç»“æœï¼š** è¿”å›æœ€æ–°çš„ 5 ç¯‡æ–‡ç« 

### åœºæ™¯ 2: è‡ªç„¶è¯­è¨€è¾“å…¥ï¼ˆLLM å¯ç”¨ï¼‰

**è¾“å…¥ï¼š** "æœ€è¿‘ AI æœ‰ä»€ä¹ˆæ–°é—»ï¼Ÿ"

**æµç¨‹ï¼š**
1. å‰ç«¯å‘é€è¯·æ±‚
2. Intent Analyzer è°ƒç”¨ LLM Service
3. Gemini åˆ†ææ„å›¾ï¼Œè¿”å› Intent(command="/latest", confidence=0.95)
4. éªŒè¯å‘½ä»¤æœ‰æ•ˆæ€§
5. æ‰§è¡Œæ’ä»¶
6. è¿”å›ç»“æœ

**é¢„æœŸç»“æœï¼š** è¿”å›æœ€æ–°çš„ AI æ–°é—»

### åœºæ™¯ 3: è‡ªç„¶è¯­è¨€è¾“å…¥ï¼ˆLLM ä¸å¯ç”¨ï¼‰

**è¾“å…¥ï¼š** "æœ€è¿‘ AI æœ‰ä»€ä¹ˆæ–°é—»ï¼Ÿ"

**æµç¨‹ï¼š**
1. å‰ç«¯å‘é€è¯·æ±‚
2. Intent Analyzer æ£€æµ‹åˆ° LLM ä¸å¯ç”¨
3. è‡ªåŠ¨é™çº§åˆ°å…³é”®è¯åŒ¹é…
4. è¿”å› Intent(command="/latest", confidence=0.7)
5. æ‰§è¡Œæ’ä»¶
6. è¿”å›ç»“æœ

**é¢„æœŸç»“æœï¼š** è¿”å›æœ€æ–°çš„æ–‡ç« ï¼ˆé™çº§ä½†ä»å¯ç”¨ï¼‰

### åœºæ™¯ 4: é”™è¯¯å¤„ç†

**è¾“å…¥ï¼š** `/unknown_command`

**æµç¨‹ï¼š**
1. å‰ç«¯å‘é€è¯·æ±‚
2. Intent Analyzer è§£æå‘½ä»¤
3. Plugin Manager æ‰¾ä¸åˆ°å¯¹åº”æ’ä»¶
4. è¿”å›é”™è¯¯å“åº”

**é¢„æœŸç»“æœï¼š** è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: åç«¯æœåŠ¡æ— æ³•å¯åŠ¨

**é”™è¯¯ï¼š**
```
ModuleNotFoundError: No module named 'fastapi'
```

**è§£å†³ï¼š**
```bash
cd agent-backend
pip install -r requirements.txt
```

### é—®é¢˜ 2: å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é”™è¯¯ï¼š**
```
Agent service unavailable
```

**è§£å†³ï¼š**
1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`curl http://localhost:8000/api/agent/health`
2. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š`PYTHON_BACKEND_URL=http://localhost:8000`
3. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨

### é—®é¢˜ 3: LLM æœåŠ¡ä¸å¯ç”¨

**è­¦å‘Šï¼š**
```
WARNING: LLM service not available, falling back to keyword matching
```

**è§£å†³ï¼š**
1. æ£€æŸ¥ API Keyï¼š`cat .env | grep GOOGLE_API_KEY`
2. æ£€æŸ¥ LLM Providerï¼š`cat .env | grep LLM_PROVIDER`
3. è¿è¡Œæµ‹è¯•ï¼š`python scripts/test_llm_setup.py`

### é—®é¢˜ 4: æµ‹è¯•å¤±è´¥

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ä¾èµ–
pip list | grep -E "fastapi|httpx|pydantic"

# æ£€æŸ¥ä»£ç 
python scripts/verify_stage3.py

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
python scripts/test_e2e.py
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **é˜¶æ®µ 1 æ€»ç»“**: [STAGE1_SUMMARY.md](STAGE1_SUMMARY.md) - LLM Service å®ç°
- **é˜¶æ®µ 2 æ€»ç»“**: [STAGE2_SUMMARY.md](STAGE2_SUMMARY.md) - Intent Analyzer é›†æˆ
- **é˜¶æ®µ 3 æ€»ç»“**: [STAGE3_SUMMARY.md](STAGE3_SUMMARY.md) - æœ¬æ–‡ä»¶
- **ç³»ç»Ÿè®¾è®¡**: [DESIGN.md](DESIGN.md) - æ•´ä½“æ¶æ„è®¾è®¡

---

## ğŸ¯ è®¾è®¡åŸåˆ™éµå¾ª

### 1. å…³æ³¨ç‚¹åˆ†ç¦»

- **å‰ç«¯**: ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
- **Next.js ä»£ç†**: è¯·æ±‚è½¬å‘å’Œé”™è¯¯å¤„ç†
- **Python åç«¯**: ä¸šåŠ¡é€»è¾‘å’Œ AI å¤„ç†
- **æ’ä»¶ç³»ç»Ÿ**: å…·ä½“åŠŸèƒ½å®ç°

### 2. ç»Ÿä¸€çš„æ•°æ®æµ

```
æ‰€æœ‰è¾“å…¥ â†’ Intent Analyzer â†’ Intent â†’ Plugin Manager â†’ Plugin â†’ Response
```

æ— è®ºæ˜¯å‘½ä»¤å¼è¿˜æ˜¯è‡ªç„¶è¯­è¨€ï¼Œéƒ½ç»è¿‡ç›¸åŒçš„å¤„ç†æµç¨‹ã€‚

### 3. é™çº§ä¿éšœ

- LLM ä¸å¯ç”¨ â†’ å…³é”®è¯åŒ¹é…
- åç«¯ä¸å¯ç”¨ â†’ å‹å¥½é”™è¯¯æç¤º
- æ’ä»¶å¤±è´¥ â†’ é”™è¯¯å“åº”

### 4. å¯æµ‹è¯•æ€§

- å•å…ƒæµ‹è¯•ï¼šæµ‹è¯•å•ä¸ªç»„ä»¶
- é›†æˆæµ‹è¯•ï¼šæµ‹è¯•ç»„ä»¶é—´äº¤äº’
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼šæµ‹è¯•å®Œæ•´æµç¨‹
- å‰åç«¯æµ‹è¯•ï¼šæµ‹è¯•è·¨æœåŠ¡é€šä¿¡

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰

1. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ å“åº”ç¼“å­˜
   - ä¼˜åŒ– LLM è°ƒç”¨
   - å‡å°‘ç½‘ç»œå»¶è¿Ÿ

2. **é”™è¯¯å¤„ç†å¢å¼º**
   - æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
   - é”™è¯¯æ¢å¤æœºåˆ¶
   - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

3. **ç›‘æ§å’Œæ—¥å¿—**
   - æ·»åŠ æ€§èƒ½ç›‘æ§
   - è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—
   - é”™è¯¯è¿½è¸ª

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2 æœˆï¼‰

1. **åŠŸèƒ½å¢å¼º**
   - ä¼šè¯ç®¡ç†
   - ä¸Šä¸‹æ–‡è®°å¿†
   - ç”¨æˆ·åå¥½

2. **æµ‹è¯•è¦†ç›–**
   - å¢åŠ æµ‹è¯•ç”¨ä¾‹
   - å‹åŠ›æµ‹è¯•
   - å®‰å…¨æµ‹è¯•

3. **æ–‡æ¡£å®Œå–„**
   - API æ–‡æ¡£
   - éƒ¨ç½²æŒ‡å—
   - ç”¨æˆ·æ‰‹å†Œ

### é•¿æœŸè§„åˆ’ï¼ˆ3-6 æœˆï¼‰

1. **ç”Ÿäº§éƒ¨ç½²**
   - Docker å®¹å™¨åŒ–
   - CI/CD æµç¨‹
   - ç›‘æ§å‘Šè­¦

2. **æ‰©å±•æ€§**
   - æ”¯æŒæ›´å¤š LLM
   - æ’ä»¶å¸‚åœº
   - å¤šè¯­è¨€æ”¯æŒ

3. **ç”¨æˆ·ä½“éªŒ**
   - å®æ—¶å“åº”
   - æµå¼è¾“å‡º
   - ä¸ªæ€§åŒ–æ¨è

---

## âœ¨ æ€»ç»“

é˜¶æ®µ 3 å·²æˆåŠŸå®Œæˆï¼æˆ‘ä»¬å®ç°äº†ï¼š

âœ… LLM Service é›†æˆåˆ° API è·¯ç”±
âœ… å®Œæ•´çš„æ„å›¾åˆ†æ â†’ æ‰§è¡Œæµç¨‹
âœ… ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
âœ… å‰åç«¯é›†æˆæµ‹è¯•è„šæœ¬
âœ… å®Œæ•´çš„æ•°æ®æµéªŒè¯
âœ… é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶

**ç³»ç»Ÿç°åœ¨å¯ä»¥ï¼š**
- ğŸš€ å¤„ç†å‰ç«¯åˆ°åç«¯çš„å®Œæ•´è¯·æ±‚
- ğŸ§  æ™ºèƒ½ç†è§£è‡ªç„¶è¯­è¨€
- ğŸ”„ è‡ªåŠ¨é™çº§ä¿è¯å¯ç”¨æ€§
- âœ… æ‰§è¡Œæ’ä»¶å¹¶è¿”å›ç»“æœ
- ğŸ“ è®°å½•è¯¦ç»†æ—¥å¿—
- ğŸ§ª é€šè¿‡å®Œæ•´çš„æµ‹è¯•éªŒè¯

**å‡†å¤‡å¥½éƒ¨ç½²äº†å—ï¼Ÿ**

æŸ¥çœ‹éƒ¨ç½²æ–‡æ¡£æˆ–ç»§ç»­ä¼˜åŒ–ç³»ç»Ÿï¼

---

**åˆ›å»ºæ—¶é—´**: 2024-11-19
**çŠ¶æ€**: âœ… å®Œæˆ
**ä¸‹ä¸€é˜¶æ®µ**: ç”Ÿäº§éƒ¨ç½²å’Œä¼˜åŒ–
