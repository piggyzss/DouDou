# AI News Agent Backend

åŸºäºFastAPIçš„AIæ–°é—»Agentåç«¯æœåŠ¡ï¼Œé‡‡ç”¨æ’ä»¶åŒ–æ¶æ„è®¾è®¡ã€‚

## ğŸ—ï¸ æ•´ä½“æ¶æ„å’Œå·¥ä½œæµç¨‹

### æ¶æ„æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js UI   â”‚â”€â”€â”€â”€â”‚  Next.js API   â”‚â”€â”€â”€â”€â”‚  Python Agent  â”‚
â”‚   (Terminal)    â”‚    â”‚   (Wrapper)     â”‚    â”‚   (Core Logic)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
    WebSocketè¿æ¥              HTTPè°ƒç”¨                 æ’ä»¶ç³»ç»Ÿ
         â”‚                       â”‚                       â”‚
    ç”¨æˆ·äº¤äº’ç•Œé¢              ä¸­é—´ä»¶/ç¼“å­˜               AIèµ„è®¯æœåŠ¡

è¯¦ç»†å·¥ä½œæµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ FastAPIè·¯ç”± â†’ æ’ä»¶ç®¡ç†å™¨ â†’ å…·ä½“æ’ä»¶ â†’ è¿”å›å“åº”
    â†“           â†“            â†“           â†“         â†“
  /latest    agent.py   plugin_manager  news_plugin  ç»“æ„åŒ–å“åº”
```

### æ ¸å¿ƒå·¥ä½œæµç¨‹
1. **ç”¨æˆ·è¾“å…¥**: åœ¨å‰ç«¯ç»ˆç«¯è¾“å…¥å‘½ä»¤ï¼ˆå¦‚ `/latest`ï¼‰
2. **è¯·æ±‚è·¯ç”±**: é€šè¿‡ `/api/agent/execute` ç«¯ç‚¹è¿›å…¥åç«¯
3. **å‘½ä»¤è§£æ**: æ’ä»¶ç®¡ç†å™¨è§£æå‘½ä»¤ï¼Œæ‰¾åˆ°å¯¹åº”æ’ä»¶
4. **æ’ä»¶æ‰§è¡Œ**: è°ƒç”¨æ’ä»¶çš„ `execute()` æ–¹æ³•å¤„ç†è¯·æ±‚
5. **å“åº”è¿”å›**: æ’ä»¶è¿”å›ç»“æ„åŒ–å“åº”ç»™å‰ç«¯æ˜¾ç¤º

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”Œ æ’ä»¶åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±•
- ğŸ“° AIæ–°é—»èµ„è®¯æ”¶é›†å’Œåˆ†æ
- ğŸš€ å¼‚æ­¥å¤„ç†ï¼Œé«˜æ€§èƒ½
- ğŸ”„ Redisç¼“å­˜æ”¯æŒ
- ğŸ“ å®Œæ•´çš„APIæ–‡æ¡£
- ğŸ›¡ï¸ CORSå’Œå®‰å…¨é…ç½®

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
agent-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # FastAPIåº”ç”¨å…¥å£ - é…ç½®CORSã€æ³¨å†Œè·¯ç”±
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç† - ç¯å¢ƒå˜é‡ã€Redisã€APIå¯†é’¥é…ç½®
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ base.py             # åŸºç¡€æ¨¡å‹ - å®šä¹‰æ’ä»¶æŠ½è±¡ç±»å’Œæ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ news.py             # æ–°é—»æ¨¡å‹ - æ–°é—»æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ plugins/
â”‚   â”‚   â””â”€â”€ news_plugin.py      # AIèµ„è®¯æ’ä»¶ - å®ç°æ–°é—»è·å–å’Œå¤„ç†é€»è¾‘
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ news_collector.py   # æ–°é—»æ”¶é›†æœåŠ¡ - ä»å„æ•°æ®æºæ”¶é›†æ–°é—»
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ plugin_manager.py   # æ’ä»¶ç®¡ç†å™¨ - æ’ä»¶æ³¨å†Œã€å‘½ä»¤åˆ†å‘ã€æ‰§è¡Œç®¡ç†
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ routes/
â”‚           â””â”€â”€ agent.py        # Agent APIè·¯ç”± - å¤„ç†HTTPè¯·æ±‚å’Œå“åº”
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ Dockerfile                  # Dockerå®¹å™¨åŒ–é…ç½®
â””â”€â”€ README.md                   # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: Dockeræ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰

**ä¼˜åŠ¿**: è§£å†³Pythonä¾èµ–é—®é¢˜ï¼Œä¿æŒå‰ç«¯è°ƒè¯•ä¾¿åˆ©æ€§

```bash
# ä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
./start-dev-docker.sh

# æœåŠ¡åœ°å€ï¼š
# - åç«¯: http://localhost:8000
# - APIæ–‡æ¡£: http://localhost:8000/docs
# - å‰ç«¯: http://localhost:3000/agent
```

**å·¥ä½œåŸç†**:
- Pythonåç«¯è¿è¡Œåœ¨Dockerå®¹å™¨ä¸­ï¼ˆè‡ªåŠ¨çƒ­é‡è½½ï¼‰
- Next.jså‰ç«¯è¿è¡Œåœ¨æœ¬åœ°ï¼ˆä¿æŒCursorè°ƒè¯•åŠŸèƒ½ï¼‰
- ä¸€é”®å¯åŠ¨/åœæ­¢ï¼Œç¯å¢ƒéš”ç¦»

### æ–¹æ³•2: ä¼ ç»Ÿæœ¬åœ°å¼€å‘

```bash
# 1. å®‰è£…ä¾èµ–
cd agent-backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env  # ç¼–è¾‘ç›¸åº”é…ç½®

# 3. å¯åŠ¨æœåŠ¡
python -m app.main
# æˆ–ä½¿ç”¨uvicorn
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 4. è®¿é—®æœåŠ¡

- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **Agenté¡µé¢**: http://localhost:3000/agentï¼ˆéœ€è¦å‰ç«¯è¿è¡Œï¼‰

## APIç«¯ç‚¹

### Agentç›¸å…³
- `POST /api/agent/execute` - æ‰§è¡ŒAgentå‘½ä»¤
- `GET /api/agent/plugins` - è·å–æ‰€æœ‰æ’ä»¶
- `GET /api/agent/commands` - è·å–æ‰€æœ‰å‘½ä»¤
- `GET /api/agent/health` - å¥åº·æ£€æŸ¥

### ç³»ç»Ÿç›¸å…³
- `GET /` - æœåŠ¡ä¿¡æ¯
- `GET /health` - å¥åº·æ£€æŸ¥

## æ”¯æŒçš„å‘½ä»¤

### AIèµ„è®¯æ’ä»¶ (news)
- `/latest [count]` - è·å–æœ€æ–°AIèµ„è®¯
- `/trending [category]` - è·å–çƒ­é—¨è¶‹åŠ¿
- `/categories` - æ˜¾ç¤ºèµ„è®¯åˆ†ç±»
- `/deepdive <topic>` - æ·±åº¦åˆ†æç‰¹å®šä¸»é¢˜
- `/help [command]` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

## æ’ä»¶å¼€å‘

è¦æ·»åŠ æ–°çš„æ’ä»¶ï¼Œè¯·ï¼š

1. ç»§æ‰¿ `BasePlugin` ç±»
2. å®ç° `get_commands()` å’Œ `execute()` æ–¹æ³•
3. åœ¨ `plugin_manager.py` ä¸­æ³¨å†Œæ’ä»¶

ç¤ºä¾‹ï¼š
```python
from app.models.base import BasePlugin, AgentCommand, AgentRequest, AgentResponse

class MyPlugin(BasePlugin):
    def __init__(self):
        super().__init__(
            name="æˆ‘çš„æ’ä»¶",
            plugin_id="my_plugin",
            description="æ’ä»¶æè¿°"
        )
    
    def get_commands(self):
        return [
            AgentCommand(
                command="/mycommand",
                description="æˆ‘çš„å‘½ä»¤",
                usage="/mycommand [param]",
                examples=["/mycommand hello"]
            )
        ]
    
    async def execute(self, request: AgentRequest):
        # å¤„ç†é€»è¾‘
        return AgentResponse(
            success=True,
            data="å“åº”æ•°æ®",
            type="text",
            plugin=self.id,
            command=request.command
        )
```

## ğŸ³ Dockerå¼€å‘ç¯å¢ƒ

### æ··åˆæ¨¡å¼æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬åœ°å‰ç«¯      â”‚â”€â”€â”€â”€â”‚   Dockeråç«¯    â”‚    â”‚   Docker Redis  â”‚
â”‚   Next.js       â”‚    â”‚   Python Agent  â”‚    â”‚   ç¼“å­˜æœåŠ¡      â”‚
â”‚   (çƒ­é‡è½½)      â”‚    â”‚   (å®¹å™¨åŒ–)      â”‚    â”‚   (å¯é€‰)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
    Cursorè°ƒè¯•              è‡ªåŠ¨é‡è½½                  æ•°æ®ç¼“å­˜
    ç«¯å£: 3000              ç«¯å£: 8000              ç«¯å£: 6379
```

### ä¸ºä»€ä¹ˆé€‰æ‹©æ··åˆæ¨¡å¼ï¼Ÿ

**è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š**
- âœ… **Pythonä¾èµ–åœ°ç‹±**: å®¹å™¨åŒ–éš”ç¦»ï¼Œä¸å†æœ‰ç‰ˆæœ¬å†²çª
- âœ… **ç¯å¢ƒä¸€è‡´æ€§**: å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
- âœ… **ä¿æŒè°ƒè¯•ä¾¿åˆ©**: å‰ç«¯æœ¬åœ°è¿è¡Œï¼ŒCursorè°ƒè¯•åŠŸèƒ½å®Œå…¨å¯ç”¨
- âœ… **ç®€åŒ–å¯åŠ¨**: ä¸€é”®å¯åŠ¨ï¼Œæ— éœ€å¤æ‚çš„ç¯å¢ƒé…ç½®

**Dockeré…ç½®æ–‡ä»¶ï¼š**
- `Dockerfile.dev` - å¼€å‘ä¸“ç”¨é•œåƒï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
- `docker-compose.dev.yml` - å®Œæ•´å¼€å‘ç¯å¢ƒç¼–æ’
- `start-dev-docker.sh` - ä¸€é”®å¯åŠ¨è„šæœ¬

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒ
./start-dev-docker.sh

# åœæ­¢å¼€å‘ç¯å¢ƒ  
./stop-dev-docker.sh

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs -f agent-backend

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# é‡å¯åç«¯æœåŠ¡
docker-compose -f docker-compose.dev.yml restart agent-backend
```

### æµ‹è¯•éªŒè¯

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æµ‹è¯•Agentå‘½ä»¤
curl -X POST http://localhost:8000/api/agent/execute \
  -H "Content-Type: application/json" \
  -d '{"command":"/help","params":{}}'

# åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•
# è®¿é—® http://localhost:3000/agent
# è¾“å…¥å‘½ä»¤: /help, /latest
```

### æ•…éšœæ’é™¤

**å¸¸è§é—®é¢˜ï¼š**
- **å®¹å™¨å¯åŠ¨å¤±è´¥**: `docker-compose -f docker-compose.dev.yml logs agent-backend`
- **ç«¯å£å ç”¨**: `lsof -i :8000` æŸ¥çœ‹ç«¯å£ä½¿ç”¨
- **CORSé”™è¯¯**: æ£€æŸ¥ç¯å¢ƒå˜é‡ `ALLOWED_ORIGINS`
- **çƒ­é‡è½½ä¸å·¥ä½œ**: æ£€æŸ¥ä»£ç æŒ‚è½½ `docker-compose -f docker-compose.dev.yml exec agent-backend ls -la /app`

**ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¯·å‚è€ƒ**: [éƒ¨ç½²æŒ‡å—](../docs/deployment-guide.md)

## è®¸å¯è¯

MIT License
