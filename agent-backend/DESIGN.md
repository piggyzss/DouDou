# ReAct Agent ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ä¸€ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#äºŒæ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#ä¸‰æ ¸å¿ƒç»„ä»¶è¯¦è§£)
4. [æ•°æ®æ¨¡å‹](#å››æ•°æ®æ¨¡å‹)
5. [ReAct å·¥ä½œæµç¨‹](#äº”reactå·¥ä½œæµç¨‹)
6. [LLM é›†æˆç­–ç•¥](#å…­llmé›†æˆç­–ç•¥)
7. [æ•°æ®åº“è®¾è®¡](#ä¸ƒæ•°æ®åº“è®¾è®¡)
8. [æŠ€æœ¯å®ç°ç»†èŠ‚](#å…«æŠ€æœ¯å®ç°ç»†èŠ‚)

---

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 ReAct Agent ç®€ä»‹

ReAct (Reasoning + Acting) Agent æ˜¯ä¸€ä¸ªæ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼Œé€šè¿‡äº¤æ›¿è¿›è¡Œæ¨ç†å’Œè¡ŒåŠ¨æ¥è§£å†³å¤æ‚ä»»åŠ¡ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- ğŸ§  **å¤šæ­¥æ¨ç†**ï¼šæœ€å¤š 5 æ¬¡è¿­ä»£çš„æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯
- ğŸ“‹ **ä»»åŠ¡è§„åˆ’**ï¼šè‡ªåŠ¨åˆ†è§£å¤æ‚æŸ¥è¯¢ä¸ºå¯æ‰§è¡Œæ­¥éª¤
- ğŸ”§ **å·¥å…·ç¼–æ’**ï¼šæ™ºèƒ½é€‰æ‹©å’Œæ‰§è¡Œå·¥å…·é“¾
- ğŸ’¾ **ä¼šè¯è®°å¿†**ï¼šæŒä¹…åŒ–å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡
- ğŸ¯ **è´¨é‡è¯„ä¼°**ï¼šè‡ªæˆ‘åæ€å’Œè¾“å‡ºè´¨é‡è¯„ä¼°
- ğŸ”„ **å‘åå…¼å®¹**ï¼šæ”¯æŒæ—§ç‰ˆå‘½ä»¤å¼ API

### 1.2 æ¶æ„æ¼”è¿›

```
V1.0 (å‘½ä»¤è·¯ç”±)          V2.0 (å·¥å…·é€‰æ‹©)          V3.0 (ReAct Agent)
     â†“                        â†“                        â†“
å‘½ä»¤ â†’ æ’ä»¶              è‡ªç„¶è¯­è¨€ â†’ LLM â†’ å·¥å…·    æŸ¥è¯¢ â†’ è§„åˆ’ â†’ ReActå¾ªç¯
å•æ¬¡æ‰§è¡Œ                 å•æ¬¡æ‰§è¡Œ                  å¤šæ­¥æ¨ç†
æ— çŠ¶æ€                   æ— çŠ¶æ€                    ä¼šè¯è®°å¿†
æ— è§„åˆ’                   æ— è§„åˆ’                    ä»»åŠ¡åˆ†è§£
```

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer                       â”‚
â”‚  Frontend (React) + API Routes (FastAPI)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Layer                       â”‚
â”‚  ReactAgent + TaskPlanner + ReflectionEngine                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Domain Layer                           â”‚
â”‚  ToolOrchestrator + ConversationMemory + ToolRegistry       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Infrastructure Layer                      â”‚
â”‚  LLM Service + PostgreSQL + Plugin Manager                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### 2.2 æ ¸å¿ƒå·¥ä½œæµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
1. ReactAgent.execute()
   â”œâ”€ åŠ è½½ä¼šè¯å†å² (ConversationMemory)
   â”œâ”€ åˆ›å»ºæ‰§è¡Œè®¡åˆ’ (TaskPlanner)
   â””â”€ è¿›å…¥ ReAct å¾ªç¯
    â†“
2. ReAct å¾ªç¯è¿­ä»£ (æœ€å¤š 5 æ¬¡)
   â”œâ”€ Thought: LLM ç”Ÿæˆæ¨ç†
   â”œâ”€ Action: é€‰æ‹©å·¥å…·å’Œå‚æ•°
   â”œâ”€ Execute: ToolOrchestrator æ‰§è¡Œå·¥å…·
   â”œâ”€ Observation: è®°å½•æ‰§è¡Œç»“æœ
   â””â”€ Reflect: åˆ¤æ–­æ˜¯å¦ç»§ç»­
    â†“
3. ä»»åŠ¡å®Œæˆ
   â”œâ”€ åˆæˆæœ€ç»ˆå“åº” (LLM)
   â”œâ”€ è¯„ä¼°è¾“å‡ºè´¨é‡
   â”œâ”€ ä¿å­˜åˆ°ä¼šè¯å†å²
   â””â”€ è¿”å›å®Œæ•´å“åº”
```

### 2.3 ç»„ä»¶äº¤äº’å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReactAgent   â”‚ â—„â”€â”€â”€ åè°ƒæ‰€æœ‰ç»„ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        â”‚ TaskPlanner  â”‚ åˆ›å»ºæ‰§è¡Œè®¡åˆ’
       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        â”‚ Tool         â”‚ æ‰§è¡Œå·¥å…·é“¾
       â”‚        â”‚ Orchestrator â”‚
       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        â”‚ Conversation â”‚ ç®¡ç†ä¼šè¯å†å²
       â”‚        â”‚ Memory       â”‚
       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ LLM Service  â”‚ ç”Ÿæˆæ¨ç†å’Œå“åº”
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 3.1 ReactAgent (æ‰§è¡Œå™¨)

**æ–‡ä»¶**: `app/core/react_agent.py`

**èŒè´£**ï¼š
- åè°ƒ ReAct å¾ªç¯æ‰§è¡Œ
- ç®¡ç†è¿­ä»£çŠ¶æ€å’Œå†å²
- é›†æˆæ‰€æœ‰å­ç»„ä»¶
- åˆæˆæœ€ç»ˆå“åº”

**å…³é”®æ–¹æ³•**ï¼š
```python
class ReactAgent:
    async def execute(
        query: str, 
        session_id: str,
        context: Optional[Dict] = None
    ) -> ReactResponse:
        """æ‰§è¡Œç”¨æˆ·æŸ¥è¯¢ï¼Œä½¿ç”¨ ReAct å¾ªç¯"""
        
    async def _react_loop(
        query: str,
        plan: ExecutionPlan,
        context: Dict
    ) -> List[ReActStep]:
        """æ‰§è¡Œ ReAct å¾ªç¯"""
        
    async def _react_iteration(
        query: str,
        plan: ExecutionPlan,
        history: List[ReActStep],
        context: Dict,
        iteration: int
    ) -> ReActStep:
        """æ‰§è¡Œå•æ¬¡ ReAct è¿­ä»£"""
        
    async def _synthesize_response(
        query: str,
        steps: List[ReActStep],
        plan: ExecutionPlan
    ) -> str:
        """ä»æ‰§è¡Œå†å²åˆæˆæœ€ç»ˆå“åº”"""
```

**è®¾è®¡åŸåˆ™**ï¼š
- å•ä¸€èŒè´£ï¼šä¸“æ³¨äºå¾ªç¯åè°ƒ
- ä¾èµ–æ³¨å…¥ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
- é”™è¯¯æ¢å¤ï¼šä¼˜é›…å¤„ç†å„ç§å¼‚å¸¸
- å‘åå…¼å®¹ï¼šæ”¯æŒæ—§ç‰ˆ API æ ¼å¼


### 3.2 TaskPlanner (ä»»åŠ¡è§„åˆ’å™¨)

**æ–‡ä»¶**: `app/core/task_planner.py`

**èŒè´£**ï¼š
- åˆ†ææŸ¥è¯¢å¤æ‚åº¦ï¼ˆç®€å•/ä¸­ç­‰/å¤æ‚ï¼‰
- å°†å¤æ‚æŸ¥è¯¢åˆ†è§£ä¸ºå­ä»»åŠ¡
- è¯†åˆ«æ‰€éœ€å·¥å…·å’Œæ‰§è¡Œé¡ºåº
- æ ¹æ®æ‰§è¡Œåé¦ˆè°ƒæ•´è®¡åˆ’

**å…³é”®æ–¹æ³•**ï¼š
```python
class TaskPlanner:
    async def create_plan(
        query: str,
        conversation_history: List[ConversationTurn],
        context: Dict
    ) -> ExecutionPlan:
        """åˆ›å»ºæ‰§è¡Œè®¡åˆ’"""
        
    async def adjust_plan(
        plan: ExecutionPlan,
        observation: str
    ) -> ExecutionPlan:
        """æ ¹æ®æ‰§è¡Œç»“æœè°ƒæ•´è®¡åˆ’"""
        
    def _classify_complexity(
        query: str
    ) -> Literal["simple", "medium", "complex"]:
        """åˆ†ç±»æŸ¥è¯¢å¤æ‚åº¦"""
```

**å¤æ‚åº¦åˆ†ç±»è§„åˆ™**ï¼š
- **ç®€å•**ï¼šå•ä¸€å·¥å…·è°ƒç”¨å³å¯å®Œæˆï¼ˆå¦‚ "æœ€æ–°æ–°é—»"ï¼‰
- **ä¸­ç­‰**ï¼šéœ€è¦ 2-3 ä¸ªå·¥å…·è°ƒç”¨ï¼ˆå¦‚ "åˆ†æ OpenAI è¿›å±•"ï¼‰
- **å¤æ‚**ï¼šéœ€è¦ 3+ ä¸ªå·¥å…·è°ƒç”¨æˆ–å¤æ‚æ¨ç†ï¼ˆå¦‚ "å¯¹æ¯”åˆ†æå¤šå®¶å…¬å¸"ï¼‰

### 3.3 ConversationMemory (ä¼šè¯è®°å¿†)

**æ–‡ä»¶**: `app/core/conversation_memory.py`

**èŒè´£**ï¼š
- å­˜å‚¨å’Œæ£€ç´¢å¯¹è¯å†å²
- ç®¡ç†ä¼šè¯ç”Ÿå‘½å‘¨æœŸ
- å‹ç¼©é•¿å¯¹è¯ï¼ˆä½¿ç”¨ LLM æ‘˜è¦ï¼‰
- å¤„ç†ä¼šè¯è¿‡æœŸ

**å…³é”®æ–¹æ³•**ï¼š
```python
class ConversationMemory:
    async def get_history(
        session_id: str,
        limit: int = 10
    ) -> List[ConversationTurn]:
        """æ£€ç´¢å¯¹è¯å†å²"""
        
    async def save_interaction(
        session_id: str,
        query: str,
        response: ReactResponse,
        user_id: Optional[str] = None
    ) -> bool:
        """ä¿å­˜å¯¹è¯è½®æ¬¡"""
        
    async def get_context_summary(
        session_id: str
    ) -> str:
        """è·å–é•¿å¯¹è¯çš„å‹ç¼©æ‘˜è¦"""
        
    async def cleanup_expired_sessions(
        hours: int = 24
    ) -> int:
        """æ¸…ç†è¿‡æœŸä¼šè¯"""
```

**å­˜å‚¨ç­–ç•¥**ï¼š
- æœ€è¿‘ 10 æ¡å¯¹è¯ï¼šå®Œæ•´å­˜å‚¨
- 10+ æ¡å¯¹è¯ï¼šç”Ÿæˆæ‘˜è¦ï¼Œä¿ç•™æœ€è¿‘ 10 æ¡
- 24 å°æ—¶æ— æ´»åŠ¨ï¼šè‡ªåŠ¨æ¸…ç†

### 3.4 ToolOrchestrator (å·¥å…·ç¼–æ’å™¨)

**æ–‡ä»¶**: `app/core/tool_orchestrator.py`

**èŒè´£**ï¼š
- æ‰§è¡Œå·¥å…·é“¾ï¼ˆå¤„ç†ä¾èµ–å…³ç³»ï¼‰
- è§£æå‚æ•°å¼•ç”¨ï¼ˆå¦‚ `${step1.result}`ï¼‰
- å¤„ç†å·¥å…·å¤±è´¥ï¼ˆé‡è¯•é€»è¾‘ï¼‰
- ç¼“å­˜å·¥å…·ç»“æœï¼ˆ5 åˆ†é’Ÿ TTLï¼‰

**å…³é”®æ–¹æ³•**ï¼š
```python
class ToolOrchestrator:
    async def execute_tool(
        tool_call: ToolCall,
        use_cache: bool = True
    ) -> ToolResult:
        """æ‰§è¡Œå•ä¸ªå·¥å…·"""
        
    async def execute_chain(
        tools: List[ToolCall],
        context: Dict
    ) -> List[ToolResult]:
        """æ‰§è¡Œå·¥å…·é“¾"""
        
    def resolve_parameters(
        parameters: Dict[str, Any],
        previous_results: List[ToolResult]
    ) -> Dict[str, Any]:
        """è§£æå‚æ•°å¼•ç”¨"""
```

**ç¼“å­˜ç­–ç•¥**ï¼š
- ç¼“å­˜é”®ï¼š`hash(tool_name + parameters)`
- TTLï¼š5 åˆ†é’Ÿ
- å­˜å‚¨ï¼šå†…å­˜å­—å…¸ï¼ˆLRU æ·˜æ±°ï¼‰
- å‘½ä¸­ç‡ç›®æ ‡ï¼š> 30%

### 3.5 ToolRegistry (å·¥å…·æ³¨å†Œè¡¨)

**æ–‡ä»¶**: `app/core/tool_registry.py`

**èŒè´£**ï¼š
- æ³¨å†Œå’Œç®¡ç†æ‰€æœ‰å¯ç”¨å·¥å…·
- æä¾›å·¥å…·æŸ¥è¯¢æ¥å£
- å°†å·¥å…·æ ¼å¼åŒ–ä¸º LLM å¯ç†è§£çš„æ ¼å¼

**å…³é”®æ–¹æ³•**ï¼š
```python
class ToolRegistry:
    def register_tool(tool: ToolDefinition) -> None
    def get_tool(tool_name: str) -> Optional[ToolDefinition]
    def get_all_tools() -> List[ToolDefinition]
    def format_for_llm() -> str
```

---

## å››ã€æ•°æ®æ¨¡å‹

### 4.1 ReActStep (ReAct æ­¥éª¤)

```python
@dataclass
class ReActStep:
    step_number: int              # æ­¥éª¤ç¼–å·ï¼ˆä» 1 å¼€å§‹ï¼‰
    thought: str                  # Agent çš„æ€è€ƒè¿‡ç¨‹
    action: ToolCall              # é€‰æ‹©çš„å·¥å…·è°ƒç”¨
    observation: ToolResult       # å·¥å…·æ‰§è¡Œç»“æœ
    status: str                   # pending | running | completed | failed
    timestamp: datetime           # æ—¶é—´æˆ³
    
    def is_successful() -> bool:
        """åˆ¤æ–­æ­¥éª¤æ˜¯å¦æˆåŠŸ"""
        return status == "completed" and observation.is_success()
```

### 4.2 ExecutionPlan (æ‰§è¡Œè®¡åˆ’)

```python
@dataclass
class ExecutionPlan:
    query: str                    # åŸå§‹ç”¨æˆ·æŸ¥è¯¢
    complexity: str               # simple | medium | complex
    steps: List[PlanStep]         # è®¡åˆ’æ­¥éª¤åˆ—è¡¨
    estimated_iterations: int     # é¢„è®¡è¿­ä»£æ¬¡æ•°ï¼ˆ1-5ï¼‰
    created_at: datetime          # åˆ›å»ºæ—¶é—´
```

### 4.3 ReactResponse (å®Œæ•´å“åº”)

```python
@dataclass
class ReactResponse:
    success: bool                 # æ‰§è¡Œæ˜¯å¦æˆåŠŸ
    response: str                 # æœ€ç»ˆå“åº”å†…å®¹
    steps: List[ReActStep]        # æ‰§è¡Œæ­¥éª¤åˆ—è¡¨
    plan: ExecutionPlan           # æ‰§è¡Œè®¡åˆ’
    evaluation: QualityEvaluation # è´¨é‡è¯„ä¼°
    session_id: str               # ä¼šè¯ ID
    execution_time: float         # æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
    error: Optional[str]          # é”™è¯¯ä¿¡æ¯
    timestamp: datetime           # å“åº”æ—¶é—´æˆ³
```

### 4.4 QualityEvaluation (è´¨é‡è¯„ä¼°)

```python
@dataclass
class QualityEvaluation:
    completeness_score: int       # å®Œæ•´æ€§è¯„åˆ† (0-10)
    quality_score: int            # è´¨é‡è¯„åˆ† (0-10)
    missing_info: List[str]       # ç¼ºå¤±çš„ä¿¡æ¯
    needs_retry: bool             # æ˜¯å¦éœ€è¦é‡è¯•
    suggestions: List[str]        # æ”¹è¿›å»ºè®®
```

---

## äº”ã€ReAct å·¥ä½œæµç¨‹

### 5.1 å®Œæ•´æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢: "åˆ†ææœ€è¿‘ OpenAI çš„æŠ€æœ¯è¿›å±•"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½ä¼šè¯å†å²                                          â”‚
â”‚    - ä»æ•°æ®åº“åŠ è½½æœ€è¿‘ 10 æ¡å¯¹è¯                          â”‚
â”‚    - å¦‚æœå¯¹è¯è¿‡é•¿ï¼Œç”Ÿæˆæ‘˜è¦                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆ›å»ºæ‰§è¡Œè®¡åˆ’ (TaskPlanner)                           â”‚
â”‚    - å¤æ‚åº¦: medium                                      â”‚
â”‚    - æ­¥éª¤ 1: æœç´¢ OpenAI ç›¸å…³æ–°é—»                        â”‚
â”‚    - æ­¥éª¤ 2: åˆ†ææŠ€æœ¯è¶‹åŠ¿                                â”‚
â”‚    - é¢„è®¡è¿­ä»£: 2 æ¬¡                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ReAct å¾ªç¯ - è¿­ä»£ 1                                  â”‚
â”‚    Thought: "é¦–å…ˆéœ€è¦è·å– OpenAI çš„æœ€æ–°æ–°é—»..."         â”‚
â”‚    Action: search_news(query="OpenAI", count=10)        â”‚
â”‚    Observation: "æ‰¾åˆ° 10 ç¯‡ç›¸å…³æ–°é—»..."                  â”‚
â”‚    Status: completed                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ReAct å¾ªç¯ - è¿­ä»£ 2                                  â”‚
â”‚    Thought: "ç°åœ¨éœ€è¦åˆ†æè¿™äº›æ–°é—»çš„æŠ€æœ¯è¶‹åŠ¿..."         â”‚
â”‚    Action: analyze_trends(articles=[...])               â”‚
â”‚    Observation: "è¯†åˆ«å‡º 3 ä¸ªä¸»è¦æŠ€æœ¯è¶‹åŠ¿..."             â”‚
â”‚    Status: completed                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. åˆæˆæœ€ç»ˆå“åº”                                          â”‚
â”‚    - ä½¿ç”¨ LLM ä»æ‰§è¡Œå†å²ç”Ÿæˆè‡ªç„¶è¯­è¨€å“åº”                 â”‚
â”‚    - åŒ…å«æ‰€æœ‰å…³é”®ä¿¡æ¯å’Œåˆ†æç»“æœ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è´¨é‡è¯„ä¼°                                              â”‚
â”‚    - å®Œæ•´æ€§è¯„åˆ†: 9/10                                    â”‚
â”‚    - è´¨é‡è¯„åˆ†: 8/10                                      â”‚
â”‚    - éœ€è¦é‡è¯•: false                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›å®Œæ•´å“åº”ç»™ç”¨æˆ·
```

### 5.2 è¿­ä»£ç»ˆæ­¢æ¡ä»¶

ReAct å¾ªç¯åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ç»ˆæ­¢ï¼š

1. **è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°**ï¼š5 æ¬¡è¿­ä»£
2. **ä»»åŠ¡å®Œæˆ**ï¼šè¯„ä¼°è®¤ä¸ºå“åº”å·²å®Œæ•´
3. **å·¥å…·å¤±è´¥**ï¼šå¿…éœ€å·¥å…·æ‰§è¡Œå¤±è´¥
4. **è¶…æ—¶**ï¼šæ€»æ‰§è¡Œæ—¶é—´è¶…è¿‡ 30 ç§’

---

## å…­ã€LLM é›†æˆç­–ç•¥

### 6.1 LLM ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨¡å‹ | æ¸©åº¦ | æœ€å¤§ Token |
|------|------|------|-----------|
| ä»»åŠ¡è§„åˆ’ | Gemini 2.0 Flash | 0.7 | 500 |
| æ¨ç†ç”Ÿæˆ | Gemini 2.0 Flash | 0.7 | 500 |
| å“åº”åˆæˆ | Gemini 2.0 Flash | 0.7 | 800 |
| è´¨é‡è¯„ä¼° | Gemini 2.0 Flash | 0.3 | 300 |
| å¯¹è¯æ‘˜è¦ | Gemini 2.0 Flash | 0.5 | 500 |

### 6.2 æç¤ºè¯æ¨¡æ¿

**ä»»åŠ¡è§„åˆ’æç¤ºè¯**ï¼š
```
ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡è§„åˆ’åŠ©æ‰‹ã€‚åˆ†æä»¥ä¸‹ç”¨æˆ·æŸ¥è¯¢å¹¶åˆ›å»ºæ‰§è¡Œè®¡åˆ’ã€‚

ç”¨æˆ·æŸ¥è¯¢: {query}
å¯¹è¯å†å²: {history}

å¯ç”¨å·¥å…·:
{tools_description}

åˆ†ç±»æŸ¥è¯¢å¤æ‚åº¦ï¼ˆsimple/medium/complexï¼‰å¹¶åˆ†è§£ä¸ºæ­¥éª¤ã€‚
å¯¹äºæ¯ä¸ªæ­¥éª¤ï¼ŒæŒ‡å®šï¼š
- æè¿°
- ä½¿ç”¨çš„å·¥å…·
- æ‰€éœ€å‚æ•°
- æ˜¯å¦å¿…éœ€
- ä¾èµ–çš„æ­¥éª¤

è¿”å› JSON æ ¼å¼ï¼š
{
  "complexity": "simple|medium|complex",
  "steps": [...],
  "estimated_iterations": 3
}
```

**ReAct è¿­ä»£æç¤ºè¯**ï¼š
```
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½ Agentï¼Œä½¿ç”¨ ReAct æ¡†æ¶æ‰§è¡Œä»»åŠ¡ã€‚

ä»»åŠ¡: {query}
æ‰§è¡Œè®¡åˆ’: {plan}
å½“å‰è¿›åº¦: {history}

é€æ­¥æ€è€ƒï¼š
1. æˆ‘ä»¬ç›®å‰å®Œæˆäº†ä»€ä¹ˆï¼Ÿ
2. ä¸‹ä¸€æ­¥éœ€è¦åšä»€ä¹ˆï¼Ÿ
3. åº”è¯¥ä½¿ç”¨å“ªä¸ªå·¥å…·å’Œä»€ä¹ˆå‚æ•°ï¼Ÿ

è¿”å› JSON æ ¼å¼ï¼š
{
  "thought": "ä½ å¯¹ä¸‹ä¸€æ­¥çš„æ¨ç†",
  "tool_name": "è¦ä½¿ç”¨çš„å·¥å…·åç§°",
  "parameters": {"param1": "value1"}
}
```

### 6.3 æˆæœ¬ä¼˜åŒ–

**æœˆåº¦æˆæœ¬ä¼°ç®—**ï¼ˆ3000 æ¬¡æŸ¥è¯¢ï¼‰ï¼š

- ä»»åŠ¡è§„åˆ’ï¼š500 tokens Ã— 3000 = 1.5M tokens
- ReAct è¿­ä»£ï¼š1000 tokens Ã— 2 Ã— 3000 = 6M tokens
- å“åº”åˆæˆï¼š1000 tokens Ã— 3000 = 3M tokens
- æ€»è®¡ï¼šçº¦ 10.5M tokens

**Gemini 2.0 Flash å®šä»·**ï¼š
- è¾“å…¥ï¼š$0.075/1M tokens
- è¾“å‡ºï¼š$0.30/1M tokens
- æœˆåº¦æˆæœ¬ï¼šçº¦ $2-3

---

## ä¸ƒã€æ•°æ®åº“è®¾è®¡

### 7.1 è¡¨ç»“æ„

**agent_conversations** (å¯¹è¯å†å²)
```sql
CREATE TABLE agent_conversations (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(255) NOT NULL,
    user_query TEXT NOT NULL,
    agent_response TEXT NOT NULL,
    steps JSONB,                    -- ReActStep åˆ—è¡¨
    plan JSONB,                     -- ExecutionPlan
    evaluation JSONB,               -- QualityEvaluation
    created_at TIMESTAMP DEFAULT NOW(),
    INDEX idx_session_id (session_id),
    INDEX idx_created_at (created_at),
    INDEX idx_session_time (session_id, created_at DESC)
);
```

**agent_sessions** (ä¼šè¯å…ƒæ•°æ®)
```sql
CREATE TABLE agent_sessions (
    session_id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255),
    context JSONB,
    summary TEXT,                   -- å¯¹è¯æ‘˜è¦
    created_at TIMESTAMP DEFAULT NOW(),
    last_active TIMESTAMP DEFAULT NOW(),
    INDEX idx_last_active (last_active)
);
```

### 7.2 æŸ¥è¯¢ä¼˜åŒ–

**å¸¸ç”¨æŸ¥è¯¢**ï¼š
```sql
-- è·å–ä¼šè¯å†å²ï¼ˆæœ€è¿‘ 10 æ¡ï¼‰
SELECT * FROM agent_conversations
WHERE session_id = $1
ORDER BY created_at DESC
LIMIT 10;

-- æ¸…ç†è¿‡æœŸä¼šè¯
DELETE FROM agent_sessions
WHERE last_active < NOW() - INTERVAL '24 hours';
```

**ç´¢å¼•ç­–ç•¥**ï¼š
- `idx_session_id`: åŠ é€Ÿä¼šè¯æŸ¥è¯¢
- `idx_created_at`: åŠ é€Ÿæ—¶é—´èŒƒå›´æŸ¥è¯¢
- `idx_session_time`: å¤åˆç´¢å¼•ï¼Œä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢

---

## å…«ã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 8.1 é”™è¯¯å¤„ç†ç­–ç•¥

**é”™è¯¯åˆ†ç±»**ï¼š
1. **LLM é”™è¯¯**ï¼šæœåŠ¡ä¸å¯ç”¨ã€é€Ÿç‡é™åˆ¶ã€æ— æ•ˆå“åº”
2. **å·¥å…·é”™è¯¯**ï¼šå·¥å…·æœªæ‰¾åˆ°ã€å‚æ•°æ— æ•ˆã€æ‰§è¡Œè¶…æ—¶
3. **æ•°æ®åº“é”™è¯¯**ï¼šè¿æ¥å¤±è´¥ã€æŸ¥è¯¢è¶…æ—¶
4. **éªŒè¯é”™è¯¯**ï¼šæ— æ•ˆè¾“å…¥ã€ç¼ºå°‘å‚æ•°

**é‡è¯•ç­–ç•¥**ï¼š
- LLM è°ƒç”¨ï¼š3 æ¬¡é‡è¯•ï¼ŒæŒ‡æ•°é€€é¿ï¼ˆ1s, 2s, 4sï¼‰
- å·¥å…·æ‰§è¡Œï¼š2 æ¬¡é‡è¯•ï¼ˆä»…ç¬æ€é”™è¯¯ï¼‰
- æ•°æ®åº“æ“ä½œï¼š3 æ¬¡é‡è¯•ï¼Œ500ms å»¶è¿Ÿ

**é™çº§æ–¹æ¡ˆ**ï¼š
- LLM ä¸å¯ç”¨ â†’ ä½¿ç”¨ç®€å•è§„åˆ™
- æ•°æ®åº“ä¸å¯ç”¨ â†’ å†…å­˜å­˜å‚¨
- å·¥å…·å¤±è´¥ â†’ è·³è¿‡å¯é€‰å·¥å…·

### 8.2 æ€§èƒ½ä¼˜åŒ–

**ç›®æ ‡æŒ‡æ ‡**ï¼š
- ç®€å•æŸ¥è¯¢ï¼š< 2 ç§’
- å¤æ‚æŸ¥è¯¢ï¼š< 10 ç§’
- æ•°æ®åº“æŸ¥è¯¢ï¼š< 100ms
- LLM è°ƒç”¨ï¼š< 3 ç§’
- å¹¶å‘ä¼šè¯ï¼š100+

**ä¼˜åŒ–ç­–ç•¥**ï¼š
1. **å·¥å…·ç»“æœç¼“å­˜**ï¼š5 åˆ†é’Ÿ TTLï¼ŒLRU æ·˜æ±°
2. **å¯¹è¯æ‘˜è¦ç¼“å­˜**ï¼š1 å°æ—¶ TTL
3. **æ•°æ®åº“è¿æ¥æ± **ï¼šæœ€å° 5ï¼Œæœ€å¤§ 20
4. **å¼‚æ­¥æ‰§è¡Œ**ï¼šæ‰€æœ‰ I/O æ“ä½œå¼‚æ­¥åŒ–
5. **æ‰¹é‡æŸ¥è¯¢**ï¼šåˆå¹¶æ•°æ®åº“æŸ¥è¯¢

### 8.3 ç›‘æ§å’Œæ—¥å¿—

**å…³é”®æŒ‡æ ‡**ï¼š
- å¹³å‡è¿­ä»£æ¬¡æ•°
- å·¥å…·æ‰§è¡ŒæˆåŠŸç‡
- LLM è°ƒç”¨å»¶è¿Ÿ
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- ä¼šè¯æ—¶é•¿
- é”™è¯¯ç‡ï¼ˆæŒ‰ç±»å‹ï¼‰

**æ—¥å¿—çº§åˆ«**ï¼š
- **DEBUG**ï¼šè¯¦ç»†æ‰§è¡Œè½¨è¿¹
- **INFO**ï¼šæŸ¥è¯¢å¼€å§‹/ç»“æŸã€å·¥å…·é€‰æ‹©
- **WARNING**ï¼šé‡è¯•ã€é™çº§
- **ERROR**ï¼šå¤±è´¥ï¼ˆå¸¦å †æ ˆè·Ÿè¸ªï¼‰

---

## é™„å½•

### A. æœ¯è¯­è¡¨

- **ReAct**: Reasoning + Actingï¼Œæ¨ç†å’Œè¡ŒåŠ¨çš„ç»“åˆ
- **Thought**: Agent çš„æ€è€ƒè¿‡ç¨‹
- **Action**: Agent æ‰§è¡Œçš„å·¥å…·è°ƒç”¨
- **Observation**: å·¥å…·æ‰§è¡Œçš„ç»“æœ
- **Reflection**: Agent å¯¹è¾“å‡ºè´¨é‡çš„è¯„ä¼°

### B. å‚è€ƒèµ„æ–™

- [ReAct è®ºæ–‡](https://arxiv.org/abs/2210.03629)
- [LangChain ReAct Agent](https://python.langchain.com/docs/modules/agents/agent_types/react)
- [Google Gemini API](https://ai.google.dev/docs)

---

**ç‰ˆæœ¬**: 3.0.0  
**æœ€åæ›´æ–°**: 2024-01-01  
**ä½œè€…**: Agent Backend Team
