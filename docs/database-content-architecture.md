# DouDou 内容架构设计

## 🎯 整体架构概览

```
DouDou 内容管理系统架构
┌─────────────────────────────────────────────────────────────────┐
│                        DouDou 内容系统                          │
├─────────────────┬─────────────────┬─────────────────────────────┤
│   AIGC 内容模块 │   博客内容模块  │      应用展示模块            │
├─────────────┬───┼─────────────────┼─────────────────────────────┤
│   图片内容  │音乐│视频内容│        博客文章系统              │   应用管理系统              │
│  (集合模式) │内容│(独立模式)│       (文章+标签+评论)          │   (独立应用管理)            │
│            │(独立│        │                                │                            │
│            │模式)│        │                                │                            │
└─────────────┴───┴────────┴────────────────────────────────┴────────────────────────────┘

AIGC 内容组织架构
┌─────────────────────────────────────────────────────┐
│                    AIGC 内容                         │
├─────────────────┬───────────────┬───────────────────┤
│   图片内容      │   音乐内容    │    视频内容       │
│  (集合模式)     │  (独立模式)   │   (独立模式)      │
└─────────────────┴───────────────┴───────────────────┘

┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ artwork_        │  │ music_tracks    │  │ videos          │
│ collections     │  │                 │  │                 │
│ ├─ id          │  │ ├─ id           │  │ ├─ id           │
│ ├─ title       │  │ ├─ title        │  │ ├─ title        │
│ ├─ description │  │ ├─ tags         │  │ ├─ tags         │
│ ├─ tags        │  │ ├─ audio_url    │  │ ├─ video_url    │
│ ├─ likes_count │  │ ├─ cover_url    │  │ ├─ cover_url    │
│ ├─ cover_image │  │ ├─ duration     │  │ ├─ duration     │
│ └─ ...         │  │ ├─ likes_count  │  │ ├─ likes_count  │
└─────┬───────────┘  │ └─ status      │  │ └─ status       │
      │              └─────────────────┘  └─────────────────┘
      │
      ▼ 1:N 关系
┌─────────────────┐
│ artwork_images  │
│ ├─ id          │
│ ├─ collection_id│ ◄── 外键关联
│ ├─ filename    │
│ ├─ file_url    │
│ ├─ thumbnail   │
│ ├─ file_size   │
│ ├─ width       │
│ ├─ height      │
│ └─ sort_order  │
└─────────────────┘
```

---

## 📱 应用展示模块架构设计

### 🏗️ 应用系统架构

```
应用展示管理系统
┌─────────────────────────────────────────────────────────────────────┐
│                           应用系统                                   │
├─────────────────┬─────────────────┬─────────────────┬───────────────┤
│    应用管理     │    分类系统     │    统计系统     │   用户交互    │
│   (核心内容)    │   (标签组织)    │   (数据分析)    │  (点赞浏览)   │
└─────────────────┴─────────────────┴─────────────────┴───────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ apps            │    │ 应用标签系统     │    │ 应用统计系统     │
│ ├─ id          │    │ (tags字段)      │    │ ├─ dau          │
│ ├─ name        │    │ ├─ 技术栈       │    │ ├─ downloads    │
│ ├─ slug        │    │ ├─ 功能分类     │    │ ├─ likes_count  │
│ ├─ description │    │ ├─ 平台类型     │    │ ├─ trend        │
│ ├─ type        │    │ └─ 开发状态     │    │ └─ views_count  │
│ ├─ platform    │    └─────────────────┘    └─────────────────┘
│ ├─ status      │              │                      ▲
│ ├─ tags[]      │              │                      │ 1:1 关系
│ ├─ cover_image │              │ N:M 关系              │
│ ├─ video_url   │              │                      │
│ ├─ download_url│              │                      │
│ ├─ qr_code_url │              │                      │
│ ├─ dau         │              │                      │
│ ├─ downloads   │              │                      │
│ ├─ likes_count │              │                      │
│ ├─ trend       │              │                      │
│ ├─ created_at  │              │                      │
│ └─ updated_at  │              │                      │
└─────┬───────────┘              │                      │
      │ 1:1 关系                 ▼                      │
      ▼                ┌─────────────────┐              │
┌─────────────────┐    │ 应用体验方式     │              │
│ 统一点赞系统     │    │ ├─ download    │◄─────────────┘
│ (likes表)       │    │ └─ qrcode      │
│ target_type='app'│  └─────────────────┘
│ target_id=app_id │
└─────────────────┘
```

### 🎯 应用模块设计特点

#### 1. **独立应用管理模式**

- **单一实体**: 每个应用独立管理，不采用集合模式
- **完整信息**: 包含应用的所有关键信息（描述、类型、平台、状态等）
- **多媒体支持**: 支持封面图片、演示视频、二维码等多种展示方式

#### 2. **灵活的分类系统**

- **标签数组**: 使用 PostgreSQL 数组类型存储多个标签
- **多维度分类**: 支持技术栈、功能分类、平台类型等多维度标签
- **动态扩展**: 可根据需要添加新的标签类型

#### 3. **丰富的统计功能**

- **用户数据**: DAU（日活跃用户）、下载量等关键指标
- **趋势分析**: trend 字段记录应用发展趋势
- **互动数据**: 点赞数、浏览数等用户反馈数据

#### 4. **多样化的体验方式**

- **下载体验**: 提供直接下载链接
- **扫码体验**: 提供二维码，支持移动端扫码访问
- **状态管理**: 开发中、测试版、正式版等不同状态

---

## 📝 博客内容架构设计

### 🏗️ 博客系统架构

```
博客内容管理系统
┌─────────────────────────────────────────────────────────────────────┐
│                           博客系统                                   │
├─────────────────┬─────────────────┬─────────────────┬───────────────┤
│    文章管理     │    标签系统     │    评论系统     │   用户交互    │
│   (核心内容)    │   (分类组织)    │   (社区功能)    │  (点赞浏览)   │
└─────────────────┴─────────────────┴─────────────────┴───────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ blog_posts      │    │ blog_tags       │    │ blog_comments   │
│ ├─ id          │    │ ├─ id           │    │ ├─ id           │
│ ├─ title       │    │ ├─ name         │    │ ├─ post_id      │
│ ├─ slug        │    │ ├─ slug         │    │ ├─ author_name  │
│ ├─ content     │    │ ├─ description  │    │ ├─ content      │
│ ├─ excerpt     │    │ └─ created_at   │    │ ├─ status       │
│ ├─ cover_url   │    └─────────────────┘    │ └─ created_at   │
│ ├─ status      │              │             └─────────────────┘
│ ├─ tags[]      │              │                      ▲
│ ├─ views_count │              │                      │
│ ├─ likes_count │              │                      │ 1:N 关系
│ ├─ published_at│              │ N:M 关系              │
│ └─ created_at  │              │                      │
└─────┬───────────┘              │                      │
      │ 1:N 关系                 ▼                      │
      ▼                ┌─────────────────┐              │
┌─────────────────┐    │ blog_post_tags  │              │
│ 统一点赞系统     │    │ ├─ post_id     │◄─────────────┘
│ (likes表)       │    │ └─ tag_id      │
│ target_type='blog'│  └─────────────────┘
│ target_id=post_id │
└─────────────────┘
```

## 📋 DouDou 内容系统总结

### 设计模式对比

| 模块          | 设计模式     | 核心特点           | 适用场景           |
| ------------- | ------------ | ------------------ | ------------------ |
| **AIGC 图片** | 集合模式     | 1:N 关系，批量展示 | 创意主题，多图展示 |
| **AIGC 音乐** | 独立模式     | 单一实体，独立播放 | 音频内容，单独消费 |
| **AIGC 视频** | 独立模式     | 单一实体，独立播放 | 视频内容，单独观看 |
| **应用展示**  | 产品展示模式 | 独立管理，完整信息 | 应用推广，产品展示 |
| **博客文章**  | 内容为王模式 | 状态管理，SEO优化  | 长文内容，知识分享 |
| **标签系统**  | 分类组织模式 | N:M 关系，灵活分类 | 内容分类，导航辅助 |
| **评论系统**  | 社区互动模式 | 状态审核，用户互动 | 社区建设，用户参与 |
| **点赞系统**  | 混合设计模式 | 统一逻辑，性能优化 | 用户反馈，内容评价 |

---

## 👍 点赞系统架构设计

### 🏗️ 混合设计模式

点赞系统采用**混合设计模式**，兼顾性能和功能完整性：

```
业务表 (快速查询)          点赞记录表 (详细追踪)
┌─────────────────┐       ┌─────────────────────┐
│ artwork_collections │    │      likes          │
│ ├─ id            │    │ ├─ target_type      │
│ ├─ title         │◄──┤ ├─ target_id        │
│ ├─ likes_count   │    │ ├─ anon_id          │
│ └─ ...           │    │ ├─ ip_hash          │
└─────────────────┘    │ ├─ ua_hash          │
                       │ ├─ status           │
┌─────────────────┐    │ └─ created_at       │
│   blog_posts    │    └─────────────────────┘
│ ├─ id           │◄──┘
│ ├─ title        │
│ ├─ likes_count  │
│ └─ ...          │
└─────────────────┘
```

### 📊 设计方案对比

#### 方案A: 仅业务表字段

- ✅ **优点**: 查询快速、结构简单
- ❌ **缺点**: 无法防重复、难以扩展、无历史记录

#### 方案B: 纯独立点赞表

- ✅ **优点**: 统一逻辑、易扩展、完整历史
- ❌ **缺点**: 查询性能差、缓存复杂

#### 方案C: 混合设计（当前方案）

- ✅ **优点**: 性能优异 + 功能完整 + 统一系统 + 数据一致性
- ⚠️ **缺点**: 需维护一致性、实现复杂度中等

### 🎯 设计优势

#### 1. **性能优化**

- **读取**: 直接从业务表 `likes_count` 字段获取
- **写入**: 事务同时更新点赞表和计数字段
- **列表查询**: 避免复杂的 JOIN 和 COUNT 操作

#### 2. **功能完整**

- **防重复机制**: 基于 `anon_id` 或 `ip_hash + ua_hash`
- **历史追踪**: 完整的点赞/取消点赞记录
- **状态管理**: 支持软删除（`status = 'liked'/'unliked'`）

#### 3. **扩展性强**

- **统一接口**: 所有内容类型使用相同的点赞逻辑
- **新增类型**: 只需在 `target_type` 枚举中添加
- **高级功能**: 支持排行榜、用户偏好分析等

#### 4. **数据一致性**

- **事务机制**: 保证点赞记录和计数同步
- **定时同步**: 修复可能的数据不一致
- **缓存策略**: 热点内容缓存提升性能

### 🚀 应用场景

#### 高频场景: 列表页查询

```sql
-- 直接读取计数，性能最优
SELECT id, title, likes_count FROM blog_posts ORDER BY likes_count DESC;
```

#### 中频场景: 用户点赞状态检查

```sql
-- 统一的点赞状态查询
SELECT status FROM likes
WHERE target_type = 'blog' AND target_id = 123
AND anon_id = 'user_identifier';
```

#### 低频但重要: 点赞操作

- 事务保证数据一致性
- 同时更新详细记录和计数缓存
- 支持点赞/取消点赞的状态切换

---
