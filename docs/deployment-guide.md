# é¡¹ç›®éƒ¨ç½²æŒ‡å—

## ğŸ—ï¸ æ•´ä½“éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel        â”‚    â”‚   Railway       â”‚    â”‚   è…¾è®¯äº‘COS     â”‚
â”‚   (Next.jså‰ç«¯)  â”‚â”€â”€â”€â”€â”‚   (Pythonåç«¯)   â”‚    â”‚   (æ–‡ä»¶å­˜å‚¨)     â”‚
â”‚   â€¢ é™æ€é¡µé¢     â”‚    â”‚   â€¢ AgentæœåŠ¡    â”‚    â”‚   â€¢ å›¾ç‰‡èµ„æº     â”‚
â”‚   â€¢ APIåŒ…è£…å±‚    â”‚    â”‚   â€¢ æ’ä»¶ç³»ç»Ÿ     â”‚    â”‚   â€¢ æ–‡ä»¶ä¸Šä¼      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
    ç”¨æˆ·è®¿é—®                  åç«¯é€»è¾‘                   èµ„æºå­˜å‚¨
        â”‚                        â”‚                        â”‚
   åŸŸåDNSè§£æ              Railwayå®¹å™¨åŒ–              COS CDNåŠ é€Ÿ
```

# Part 1: å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

## 1ã€ç”³è¯·åŸŸå

### 1.1 é€‰æ‹©åŸŸåæ³¨å†Œå•†
æ¨èä½¿ç”¨ä»¥ä¸‹æœåŠ¡å•†ï¼š
è…¾è®¯äº‘åŸŸåæ³¨å†Œï¼ˆæ¨èï¼Œä¸ä½ çš„è…¾è®¯äº‘æœåŠ¡é›†æˆï¼‰
é˜¿é‡Œäº‘ä¸‡ç½‘
GoDaddy
Namecheap

### 1.2 åŸŸåé€‰æ‹©å»ºè®®

ä¸»åŸŸåï¼šå»ºè®®é€‰æ‹© `.com` æˆ– `.cn` åŸŸåï¼Œyourname.com æˆ– yourname.cn
å¤‡é€‰æ–¹æ¡ˆï¼šyourname.devã€yourname.siteã€yourname.tech
ä»·æ ¼èŒƒå›´ï¼š.com åŸŸåçº¦ 60-100å…ƒ/å¹´ï¼Œ.cn åŸŸåçº¦ 30-50å…ƒ/å¹´

### 1.3 è…¾è®¯äº‘åŸŸåæ³¨å†Œæ­¥éª¤
1ã€ç™»å½• è…¾è®¯äº‘æ§åˆ¶å°
2ã€è¿›å…¥ åŸŸåæ³¨å†Œ æœåŠ¡
3ã€æœç´¢ä½ æƒ³è¦çš„åŸŸå
4ã€é€‰æ‹©åˆé€‚çš„åç¼€å’Œå¹´é™
5ã€å®Œæˆå®åè®¤è¯ï¼ˆå›½å†…åŸŸåå¿…éœ€ï¼‰
6ã€æ”¯ä»˜è´¹ç”¨

## 2ã€éƒ¨ç½²åˆ° Vercelï¼ˆæ¨èï¼‰
### 2.1 å‡†å¤‡é¡¹ç›®
é¦–å…ˆç¡®ä¿é¡¹ç›®å¯ä»¥æ­£å¸¸æ„å»ºï¼šæ„å»ºæˆåŠŸï¼

### 2.2 éƒ¨ç½²åˆ° Vercel
æ³¨å†ŒVercelè´¦å·ï¼Œè®¿é—® vercel.com
ä½¿ç”¨ GitHub è´¦å·ç™»å½•ï¼ˆæ¨èï¼‰
è¿æ¥ GitHub ä»“åº“
åœ¨ Vercel æ§åˆ¶å°ç‚¹å‡» "New Project"
é€‰æ‹©ä½ çš„ GitHub ä»“åº“
å¯¼å…¥é¡¹ç›®

é…ç½®éƒ¨ç½²è®¾ç½®
Framework Preset: Next.js
Root Directory: ./ (é»˜è®¤)
Build Command: npm run build
Output Directory: .next (é»˜è®¤)
Install Command: npm install

### 2.3 é…ç½®ç¯å¢ƒå˜é‡
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
è®©æˆ‘æ£€æŸ¥é¡¹ç›®ä¸­çš„ç¯å¢ƒå˜é‡é…ç½®ï¼š
åŸºäºä»£ç åˆ†æï¼Œæˆ‘æ¥ä¸ºä½ åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æŒ‡å—ï¼š

ç«‹å³å¼€å§‹ï¼š
ç™»å½• Vercel â†’ é€‰æ‹©é¡¹ç›® â†’ Settings â†’ Environment Variables
é€ä¸ªæ·»åŠ  ä¸Šé¢åˆ—å‡ºçš„ç¯å¢ƒå˜é‡
é‡æ–°éƒ¨ç½² é¡¹ç›®

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
### æ•°æ®åº“é…ç½®
```
DB_HOST=your_database_host
DB_PORT=5432
DB_NAME=doudou_db
DB_USER=doudou_user
DB_PASSWORD=your_database_password
```

### è…¾è®¯äº‘COSé…ç½®
```
COS_SECRET_ID=your_cos_secret_id
COS_SECRET_KEY=your_cos_secret_key
COS_BUCKET=your_bucket_name
COS_REGION=ap-beijing
COS_APP_ID=your_cos_app_id
COS_DOMAIN=https://your_bucket.cos.ap-beijing.myqcloud.com
```

### ç½‘ç«™é…ç½®
```
NEXT_PUBLIC_SITE_URL=https://yourdomain.com
NODE_ENV=production
```

## 3ã€é…ç½® DNS è§£æ

###3.1 è·å– Vercel åŸŸåä¿¡æ¯
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ‰¾åˆ° "Domains" é€‰é¡¹
è¿›å…¥é¡¹ç›®-> Project Settings -> Domains
æ·»åŠ ä½ çš„è‡ªå®šä¹‰åŸŸåï¼ˆå¦‚ï¼šyourname.comï¼‰
Vercel ä¼šæä¾› DNS é…ç½®ä¿¡æ¯

### 3.2 åœ¨è…¾è®¯äº‘é…ç½® DNS
ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
è¿›å…¥ äº‘è§£æ DNS æœåŠ¡
æ‰¾åˆ°ä½ çš„åŸŸåï¼Œç‚¹å‡» æƒå¨è§£æ-> è§£æè®¾ç½®-> åŸºç¡€è®¾ç½®->è®°å½•æ•°->æ·»åŠ è®°å½•
æˆ–è€… ç‚¹å‡» æƒå¨è§£æ ->è®°å½•ç®¡ç†
æ·»åŠ ä»¥ä¸‹è®°å½•ï¼š
```
ç±»å‹: A
ä¸»æœºè®°å½•: @
è®°å½•å€¼: 76.76.19.61 (Vercel çš„ IP)
TTL: 600

ç±»å‹: CNAME  
ä¸»æœºè®°å½•: www
è®°å½•å€¼: cname.vercel-dns.com
TTL: 600
```

## 4ã€è®¾ç½®ç”Ÿäº§æ•°æ®åº“

## 4.1 é€‰æ‹©æ•°æ®åº“æœåŠ¡
æ¨èé€‰é¡¹ï¼š
Vercel Postgresï¼ˆä¸ Vercel é›†æˆï¼Œç®€å•ï¼‰
è…¾è®¯äº‘ PostgreSQLï¼ˆä¸ç°æœ‰æœåŠ¡é›†æˆï¼‰
Supabaseï¼ˆå…è´¹é¢åº¦å¤§ï¼‰

## 4.2 ä½¿ç”¨ Vercel Postgresï¼ˆæ¨èï¼‰
åœ¨ Vercel é¡¹ç›®ä¸­é€‰æ‹© "Storage" æ ‡ç­¾
åˆ›å»º Postgres æ•°æ®åº“
è·å–è¿æ¥å­—ç¬¦ä¸²
åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®ï¼š
```
   DATABASE_URL=postgresql://username:password@host:port/database
```

## 4.3 æ•°æ®åº“åˆå§‹åŒ–
éƒ¨ç½²åéœ€è¦è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼šdeploy-init.ts

## 5ã€é…ç½®è…¾è®¯äº‘ COS

### 5.1 åˆ›å»ºå­˜å‚¨æ¡¶
1ã€ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2ã€è¿›å…¥ å¯¹è±¡å­˜å‚¨ COS æœåŠ¡
3ã€åˆ›å»ºå­˜å‚¨æ¡¶ï¼š
åç§°ï¼šyourname-website-assets
åœ°åŸŸï¼šé€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°åŸŸ
è®¿é—®æƒé™ï¼šå…¬æœ‰è¯»ç§æœ‰å†™

### 5.2 é…ç½® CORS ç­–ç•¥
åœ¨å­˜å‚¨æ¡¶è®¾ç½®ä¸­æ·»åŠ  CORS è§„åˆ™ï¼š
```
[
  {
    "AllowedOrigins": ["https://yourdomain.com", "https://www.yourdomain.com"],
    "AllowedMethods": ["GET", "POST", "PUT", "DELETE", "HEAD"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3600
  }
]
```

### 5.3 è·å– API å¯†é’¥
è¿›å…¥ è®¿é—®ç®¡ç† > API å¯†é’¥ç®¡ç†
åˆ›å»ºå¯†é’¥ï¼Œè·å– SecretId å’Œ SecretKey
åœ¨ Vercel ç¯å¢ƒå˜é‡ä¸­é…ç½®

## 6ã€éƒ¨ç½²å’ŒéªŒè¯

### 6.1 æäº¤ä»£ç åˆ° GitHub
```
git add .
git commit -m "feat: å‡†å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"
git push origin main
```

### 6.2 åœ¨ Vercel ä¸­éƒ¨ç½²
1ã€Vercel ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ›´æ–°
2ã€å¼€å§‹è‡ªåŠ¨éƒ¨ç½²
3ã€ç­‰å¾…éƒ¨ç½²å®Œæˆ

### 6.3 é…ç½®è‡ªå®šä¹‰åŸŸå
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ åŸŸå
æŒ‰ç…§æç¤ºé…ç½® DNS è§£æ
ç­‰å¾… SSL è¯ä¹¦è‡ªåŠ¨é…ç½®

## 7ã€ç”Ÿäº§ç¯å¢ƒéªŒè¯
è¿è¡ŒéªŒè¯è„šæœ¬ï¼šnpm run deploy:verify

## 8ã€æ·»åŠ éƒ¨ç½²è„šæœ¬åˆ° package.json

ä¿®å¤éªŒè¯: è¿è¡Œ npm run deploy:verify
ç›‘æ§Verceléƒ¨ç½²
ç™»å½•Vercelæ§åˆ¶å°
æŸ¥çœ‹é¡¹ç›®çš„éƒ¨ç½²è¿›åº¦
ç­‰å¾…éƒ¨ç½²çŠ¶æ€å˜ä¸º "Ready"


## 9ã€é¢„ä¼°æˆæœ¬
åŸŸåï¼š60-100å…ƒ/å¹´ï¼ˆ.com åŸŸåï¼‰
Vercelï¼šå…è´¹ï¼ˆä¸ªäººé¡¹ç›®ï¼‰
Vercel Postgresï¼šå…è´¹ï¼ˆ1GB å­˜å‚¨ï¼‰
è…¾è®¯äº‘ COSï¼šçº¦ 10-20å…ƒ/æœˆï¼ˆæ ¹æ®ä½¿ç”¨é‡ï¼‰
æ€»è®¡ï¼šçº¦ 200-300å…ƒ/å¹´

ğŸ› ï¸ æ–°å¢çš„å·¥å…·è„šæœ¬
npm run deploy:init - ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“åˆå§‹åŒ–
npm run deploy:verify - éƒ¨ç½²éªŒè¯æ£€æŸ¥
docs/deployment-guide.md - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£

âš¡ å¿«é€Ÿå¼€å§‹
ç«‹å³ç”³è¯·åŸŸåï¼šé€‰æ‹©ä½ å–œæ¬¢çš„åŸŸåå¹¶æ³¨å†Œ
éƒ¨ç½²åˆ° Vercelï¼šè¿æ¥ GitHub ä»“åº“å¼€å§‹éƒ¨ç½²
é…ç½®ç¯å¢ƒå˜é‡ï¼šæŒ‰ç…§æ–‡æ¡£é…ç½®æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒå˜é‡
éªŒè¯éƒ¨ç½²ï¼šä½¿ç”¨æä¾›çš„è„šæœ¬éªŒè¯æ‰€æœ‰æœåŠ¡




## Q&A

### é—®é¢˜ä¸€ã€æ€æ ·åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ï¼Ÿ

ğŸ”§ åœ¨ Vercel ä¸­æ·»åŠ ç¯å¢ƒå˜é‡çš„è¯¦ç»†æ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šé€šè¿‡ Vercel æ§åˆ¶å°ï¼ˆæ¨èï¼‰
1. ç™»å½•å¹¶è¿›å…¥é¡¹ç›®
è®¿é—® vercel.com å¹¶ç™»å½•
åœ¨ Dashboard ä¸­æ‰¾åˆ°ä½ çš„é¡¹ç›®
ç‚¹å‡»é¡¹ç›®åç§°è¿›å…¥é¡¹ç›®è¯¦æƒ…é¡µ
2. è¿›å…¥è®¾ç½®é¡µé¢
ç‚¹å‡»é¡¹ç›®é¡µé¢é¡¶éƒ¨çš„ "Settings" æ ‡ç­¾
åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° "Environment Variables" é€‰é¡¹
ç‚¹å‡»è¿›å…¥ç¯å¢ƒå˜é‡é…ç½®é¡µé¢
3. æ·»åŠ ç¯å¢ƒå˜é‡
ç‚¹å‡» "Add New" æŒ‰é’®
å¡«å†™ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼š
Name: å˜é‡åï¼ˆå¦‚ï¼šDATABASE_URLï¼‰
Value: å˜é‡å€¼ï¼ˆå¦‚ï¼špostgresql://username:password@host:port/databaseï¼‰
Environment: é€‰æ‹©ç¯å¢ƒï¼ˆProductionã€Previewã€Developmentï¼‰
4. æ‰¹é‡æ·»åŠ ç¯å¢ƒå˜é‡
å¯¹äºä½ çš„é¡¹ç›®ï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
ç½‘ç«™é…ç½®

#### æ–¹æ³•äºŒï¼šé€šè¿‡ Vercel CLI
1. å®‰è£… Vercel CLI
vercel
2. ç™»å½• Vercel
login
3. æ·»åŠ ç¯å¢ƒå˜é‡
production

#### æ–¹æ³•ä¸‰ï¼šé€šè¿‡ .env æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .env.local æ–‡ä»¶ï¼š
ğŸ“‹ ç¯å¢ƒå˜é‡é…ç½®æ¸…å•
å¿…éœ€çš„ç¯å¢ƒå˜é‡
å˜é‡å	æè¿°	ç¤ºä¾‹å€¼
DATABASE_URL	æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²	postgresql://user:pass@host:5432/db
COS_SECRET_ID	è…¾è®¯äº‘COSå¯†é’¥ID	AKIDxxxxxxxxxxxxxxxxxxxx
COS_SECRET_KEY	è…¾è®¯äº‘COSå¯†é’¥	xxxxxxxxxxxxxxxxxxxxxxxx
COS_BUCKET	COSå­˜å‚¨æ¡¶åç§°	yourname-website-assets-1234567890
COS_REGION	COSåœ°åŸŸ	ap-beijing
COS_APP_ID	COSåº”ç”¨ID	1234567890
COS_DOMAIN	COSåŸŸå	https://bucket.cos.ap-beijing.myqcloud.com
NEXT_PUBLIC_SITE_URL	ç½‘ç«™URL	https://yourdomain.com
NODE_ENV	ç¯å¢ƒæ ‡è¯†	production

ç¯å¢ƒå˜é‡è·å–æ–¹æ³•
1. æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
Vercel Postgres: åœ¨ Vercel é¡¹ç›® Storage ä¸­åˆ›å»ºæ•°æ®åº“åè‡ªåŠ¨ç”Ÿæˆ
è…¾è®¯äº‘ PostgreSQL: åœ¨è…¾è®¯äº‘æ§åˆ¶å°è·å–è¿æ¥ä¿¡æ¯
2. è…¾è®¯äº‘ COS é…ç½®
ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
è¿›å…¥ å¯¹è±¡å­˜å‚¨ COS æœåŠ¡
åˆ›å»ºå­˜å‚¨æ¡¶ï¼Œè®°å½•åç§°å’Œåœ°åŸŸ
è¿›å…¥ è®¿é—®ç®¡ç† > API å¯†é’¥ç®¡ç†
åˆ›å»ºå¯†é’¥ï¼Œè·å– SecretId å’Œ SecretKey

éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
1. åœ¨ Vercel ä¸­æ£€æŸ¥
è¿›å…¥é¡¹ç›® Settings > Environment Variables
ç¡®è®¤æ‰€æœ‰å˜é‡éƒ½å·²æ·»åŠ 
æ£€æŸ¥å˜é‡å€¼æ˜¯å¦æ­£ç¡®
2. é€šè¿‡ä»£ç éªŒè¯
åˆ›å»ºä¸€ä¸ªç®€å•çš„ API è·¯ç”±æ¥éªŒè¯ç¯å¢ƒå˜é‡ï¼š

éƒ¨ç½²åéªŒè¯æ­¥éª¤
1. æ£€æŸ¥å¥åº·çŠ¶æ€
éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ï¼šhttps://yourdomain.com/api/health
åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å“åº”ï¼š

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
æŸ¥çœ‹ Vercel éƒ¨ç½²æ—¥å¿—
ä½¿ç”¨å¥åº·æ£€æŸ¥ API è¯Šæ–­é—®é¢˜
æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®

å¦‚æœç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ
è¯·ç¡®ä¿åœ¨æ­£ç¡®çš„ç¯å¢ƒï¼ˆProductionï¼‰ä¸­æ·»åŠ å˜é‡
é‡æ–°éƒ¨ç½²é¡¹ç›®
æ£€æŸ¥å˜é‡åæ‹¼å†™æ˜¯å¦æ­£ç¡®


### é—®é¢˜äºŒã€æ•°æ®åº“è¿æ¥å¤±è´¥
æ£€æŸ¥ DATABASE_URL æ ¼å¼æ˜¯å¦æ­£ç¡®
ç¡®è®¤æ•°æ®åº“æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### é—®é¢˜ä¸‰ã€COS é…ç½®é”™è¯¯
éªŒè¯ COS_SECRET_ID å’Œ COS_SECRET_KEY æ˜¯å¦æ­£ç¡®
æ£€æŸ¥å­˜å‚¨æ¡¶åç§°å’Œåœ°åŸŸæ˜¯å¦åŒ¹é…
ç¡®è®¤å­˜å‚¨æ¡¶æƒé™è®¾ç½®


## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿æ‰€æœ‰ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®
2. æ•°æ®åº“è¿æ¥éœ€è¦æ”¯æŒå¤–ç½‘è®¿é—®
3. COS å­˜å‚¨æ¡¶éœ€è¦é…ç½®æ­£ç¡®çš„ CORS ç­–ç•¥
4. åŸŸåè§£æå¯èƒ½éœ€è¦ 24-48 å°æ—¶ç”Ÿæ•ˆ

---

# Part 2: Agentåç«¯éƒ¨ç½²ï¼ˆRailwayï¼‰

## ğŸš… Railwayéƒ¨ç½²Agentåç«¯

### 1. å‡†å¤‡Railwayéƒ¨ç½²

**1.1 æ³¨å†ŒRailwayè´¦å·**
```bash
# è®¿é—® railway.app
# ä½¿ç”¨GitHubè´¦å·ç™»å½•ï¼ˆæ¨èï¼‰
# è¿æ¥ä½ çš„GitHubä»“åº“
```

**1.2 å®‰è£…Railway CLIï¼ˆå¯é€‰ï¼‰**
```bash
npm install -g @railway/cli
railway login
```

### 2. é¡¹ç›®é…ç½®

**2.1 åˆ›å»ºRailwayé…ç½®æ–‡ä»¶**
åœ¨ `agent-backend/` ç›®å½•ä¸‹åˆ›å»º `railway.toml`:
```toml
[build]
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "python -m app.main"
healthcheckPath = "/health"
healthcheckTimeout = 300

[env]
PORT = "8000"
```

**2.2 ä¼˜åŒ–Dockerfileï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**
æ›´æ–° `agent-backend/Dockerfile`:
```dockerfile
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶å¹¶å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt gunicorn

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# åˆ›å»ºæ—¥å¿—ç›®å½•
RUN mkdir -p logs

# æš´éœ²ç«¯å£
EXPOSE 8000

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨å‘½ä»¤
CMD ["gunicorn", "app.main:app", "-w", "2", "-k", "uvicorn.workers.UvicornWorker", "--bind", "0.0.0.0:8000"]
```

### 3. Railwayéƒ¨ç½²æ­¥éª¤

**3.1 é€šè¿‡Dashboardéƒ¨ç½²ï¼ˆæ¨èï¼‰**
1. ç™»å½• [railway.app](https://railway.app)
2. ç‚¹å‡» "New Project"
3. é€‰æ‹© "Deploy from GitHub repo"
4. é€‰æ‹©ä½ çš„ä»“åº“
5. é€‰æ‹© `agent-backend` ç›®å½•ä½œä¸ºæ ¹ç›®å½•
6. Railwayä¼šè‡ªåŠ¨æ£€æµ‹åˆ°Dockerfileå¹¶å¼€å§‹æ„å»º

**3.2 é€šè¿‡CLIéƒ¨ç½²**
```bash
cd agent-backend
railway login
railway init
railway up
```

### 4. ç¯å¢ƒå˜é‡é…ç½®

**åœ¨Railway Dashboardä¸­æ·»åŠ ç¯å¢ƒå˜é‡:**
```bash
# åº”ç”¨é…ç½®
DEBUG=false
APP_NAME=AI News Agent
HOST=0.0.0.0
PORT=8000

# CORSé…ç½®ï¼ˆé‡è¦ï¼ï¼‰
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# Redisé…ç½®ï¼ˆRailwayæä¾›ï¼‰
# Railwayä¼šè‡ªåŠ¨æä¾›RedisæœåŠ¡ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

# API Keysï¼ˆå¯é€‰ï¼‰
OPENAI_API_KEY=your_openai_key_here
```

### 5. æ·»åŠ RedisæœåŠ¡

**åœ¨Railwayé¡¹ç›®ä¸­æ·»åŠ Redis:**
1. åœ¨Railwayé¡¹ç›®é¡µé¢ç‚¹å‡» "New Service"
2. é€‰æ‹© "Database" â†’ "Redis"
3. Railwayä¼šè‡ªåŠ¨æä¾›Redisè¿æ¥ä¿¡æ¯
4. åœ¨AgentæœåŠ¡çš„ç¯å¢ƒå˜é‡ä¸­ä¼šè‡ªåŠ¨æ³¨å…¥ `REDIS_URL`

### 6. æ›´æ–°å‰ç«¯é…ç½®

**åœ¨Vercelç¯å¢ƒå˜é‡ä¸­æ·»åŠ :**
```bash
# Pythonåç«¯æœåŠ¡åœ°å€
PYTHON_BACKEND_URL=https://your-agent-backend-production.up.railway.app
```

**æ›´æ–°Next.js APIåŒ…è£…å±‚:**
```typescript
// app/api/agent/execute/route.ts
export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    
    const response = await fetch(`${process.env.PYTHON_BACKEND_URL}/api/agent/execute`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(body)
    })
    
    if (!response.ok) {
      throw new Error(`Backend error: ${response.status}`)
    }
    
    const data = await response.json()
    return NextResponse.json(data)
  } catch (error) {
    return NextResponse.json(
      { error: 'Agent service unavailable' }, 
      { status: 503 }
    )
  }
}
```

### 7. éƒ¨ç½²éªŒè¯

**7.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€**
```bash
# è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl https://your-agent-backend-production.up.railway.app/health

# é¢„æœŸå“åº”
{
  "status": "healthy",
  "service": "agent-backend"
}
```

**7.2 æµ‹è¯•AgentåŠŸèƒ½**
```bash
# æµ‹è¯•Agentæ‰§è¡Œ
curl -X POST https://your-agent-backend-production.up.railway.app/api/agent/execute \
  -H "Content-Type: application/json" \
  -d '{"command": "/help", "params": {}}'
```

**7.3 å‰ç«¯æµ‹è¯•**
è®¿é—® `https://yourdomain.com/agent` å¹¶æµ‹è¯•:
- è¾“å…¥ `/help` æŸ¥çœ‹å¯ç”¨å‘½ä»¤
- è¾“å…¥ `/latest` è·å–æœ€æ–°èµ„è®¯
- æ£€æŸ¥å“åº”æ—¶é—´å’Œç¨³å®šæ€§

### 8. ç›‘æ§å’Œç»´æŠ¤

**8.1 Railwayç›‘æ§åŠŸèƒ½**
- **å®æ—¶æ—¥å¿—**: Railway Dashboard æä¾›å®æ—¶æ—¥å¿—æŸ¥çœ‹
- **èµ„æºç›‘æ§**: CPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ
- **éƒ¨ç½²å†å²**: æŸ¥çœ‹å†å²éƒ¨ç½²è®°å½•
- **è‡ªåŠ¨é‡å¯**: æœåŠ¡å¼‚å¸¸æ—¶è‡ªåŠ¨é‡å¯

**8.2 è®¾ç½®å‘Šè­¦ï¼ˆå¯é€‰ï¼‰**
```bash
# åœ¨Railwayä¸­è®¾ç½®å¥åº·æ£€æŸ¥
# å¦‚æœ/healthç«¯ç‚¹è¿ç»­å¤±è´¥ï¼Œä¼šè‡ªåŠ¨é‡å¯æœåŠ¡
```

### 9. æˆæœ¬ä¼˜åŒ–å»ºè®®

**9.1 èµ„æºä¼˜åŒ–**
```dockerfile
# åœ¨Dockerfileä¸­ä¼˜åŒ–èµ„æºä½¿ç”¨
CMD ["gunicorn", "app.main:app", 
     "-w", "1",  # å•è¿›ç¨‹è¶³å¤Ÿä¸ªäººç½‘ç«™ä½¿ç”¨
     "-k", "uvicorn.workers.UvicornWorker", 
     "--bind", "0.0.0.0:8000",
     "--max-requests", "100",  # é™åˆ¶è¯·æ±‚æ•°
     "--timeout", "30"]        # è®¾ç½®è¶…æ—¶
```

**9.2 ç¼“å­˜ç­–ç•¥**
```python
# åœ¨config.pyä¸­ä¼˜åŒ–ç¼“å­˜æ—¶é—´
CACHE_TTL = 7200  # å¢åŠ ç¼“å­˜æ—¶é—´åˆ°2å°æ—¶
NEWS_CACHE_TTL = 3600  # æ–°é—»ç¼“å­˜1å°æ—¶
```

### 10. æ•…éšœæ’é™¤

**å¸¸è§é—®é¢˜:**

**10.1 éƒ¨ç½²å¤±è´¥**
```bash
# æ£€æŸ¥æ„å»ºæ—¥å¿—
railway logs

# å¸¸è§åŸå› ï¼š
# - Dockerfileè·¯å¾„é”™è¯¯
# - ä¾èµ–å®‰è£…å¤±è´¥
# - ç«¯å£é…ç½®é”™è¯¯
```

**10.2 æœåŠ¡æ— å“åº”**
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
railway status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
railway logs --follow

# é‡å¯æœåŠ¡
railway restart
```

**10.3 CORSé”™è¯¯**
ç¡®ä¿Railwayç¯å¢ƒå˜é‡ä¸­çš„ `ALLOWED_ORIGINS` åŒ…å«ä½ çš„å‰ç«¯åŸŸåã€‚

## ğŸ“Š æœ€ç»ˆæˆæœ¬ä¼°ç®—

**æ€»ä½“å¹´åº¦æˆæœ¬:**
- **åŸŸå**: 30å…ƒ/å¹´
- **Vercel**: å…è´¹ï¼ˆä¸ªäººé¡¹ç›®ï¼‰
- **Railway**: å…è´¹ï¼ˆå°æµé‡ï¼‰
- **è…¾è®¯äº‘COS**: 10-20å…ƒ/æœˆ
- **æ€»è®¡**: çº¦50å…ƒ/å¹´

**Railwayæˆæœ¬è¯´æ˜:**
- å…è´¹é¢åº¦: $5/æœˆ
- è¶…å‡ºå: $0.02/å°æ—¶ (çº¦$15/æœˆ)
- ä¸ªäººç½‘ç«™é€šå¸¸åœ¨å…è´¹èŒƒå›´å†…

**æ‰©å±•å»ºè®®:**
å½“ç½‘ç«™æµé‡å¢é•¿æ—¶ï¼Œå¯ä»¥è€ƒè™‘å‡çº§åˆ°ä»˜è´¹è®¡åˆ’æˆ–è¿ç§»åˆ°ä¸“ç”¨æœåŠ¡å™¨ã€‚

