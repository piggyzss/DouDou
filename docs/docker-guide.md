# Docker çŸ¥è¯†æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—é€šè¿‡ç”ŸåŠ¨çš„æ¯”å–»å’Œå®ä¾‹ï¼Œå¸®åŠ©ä½ ç†è§£ Docker çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†ã€‚æ— è®ºä½ æ˜¯ Docker æ–°æ‰‹è¿˜æ˜¯æƒ³æ·±å…¥ç†è§£å®¹å™¨æŠ€æœ¯ï¼Œè¿™ä»½æŒ‡å—éƒ½èƒ½ä¸ºä½ æä¾›æ¸…æ™°çš„çŸ¥è¯†ä½“ç³»ã€‚

---

## ğŸ  æ ¸å¿ƒæ¦‚å¿µï¼šæˆ¿å±‹å»ºé€ æ¯”å–»

ä¸ºäº†æ›´å¥½åœ°ç†è§£ Dockerï¼Œæˆ‘ä»¬ç”¨**å»ºé€ æˆ¿å±‹**è¿™ä¸ªç»Ÿä¸€çš„æ¯”å–»æ¥è§£é‡Šæ‰€æœ‰æ¦‚å¿µã€‚

---

### 1. Dockerfile = æˆ¿å±‹è®¾è®¡å›¾çº¸

**å®šä¹‰**: ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«æ„å»º Docker é•œåƒçš„æ‰€æœ‰æŒ‡ä»¤ã€‚

**æˆ¿å±‹æ¯”å–»**: å»ºç­‘å¸ˆç»˜åˆ¶çš„è¯¦ç»†æ–½å·¥å›¾çº¸ï¼Œè®°å½•äº†å¦‚ä½•ä¸€æ­¥æ­¥å»ºé€ æˆ¿å±‹ã€‚

**ç¤ºä¾‹**:
```dockerfile
# é€‰æ‹©åœ°åŸºç±»å‹
FROM python:3.11-slim

# è§„åˆ’æˆ¿é—´å¸ƒå±€
WORKDIR /app

# åˆ—å‡ºéœ€è¦çš„å»ºææ¸…å•
COPY requirements.txt .

# é‡‡è´­å¹¶å®‰è£…å»ºæ
RUN pip install -r requirements.txt

# æ¬å…¥å®¶å…·å’Œè£…é¥°
COPY . .

# æ ‡æ³¨æˆ¿å±‹ç”¨é€”
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**ç‰¹ç‚¹**:
- ğŸ“ çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç‰ˆæœ¬æ§åˆ¶
- ğŸ”„ å¯ä»¥å¤åˆ¶æ— æ•°ä»½ï¼Œå»ºé€ å¤šæ ‹ç›¸åŒæˆ¿å±‹
- ğŸ“‹ æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªæ–½å·¥æ­¥éª¤
- ğŸ‘· ä»»ä½•äººæ‹¿åˆ°å›¾çº¸éƒ½èƒ½å»ºå‡ºä¸€æ ·çš„æˆ¿å­

**å…³é”®æŒ‡ä»¤**:
- `FROM`: é€‰æ‹©åŸºç¡€é•œåƒï¼ˆåœ°åŸºç±»å‹ï¼‰
- `WORKDIR`: è®¾ç½®å·¥ä½œç›®å½•ï¼ˆæˆ¿é—´å¸ƒå±€ï¼‰
- `COPY`: å¤åˆ¶æ–‡ä»¶ï¼ˆæ¬è¿ç‰©å“ï¼‰
- `RUN`: æ‰§è¡Œå‘½ä»¤ï¼ˆæ–½å·¥æ“ä½œï¼‰
- `CMD`: å®¹å™¨å¯åŠ¨å‘½ä»¤ï¼ˆæˆ¿å±‹ç”¨é€”ï¼‰
- `EXPOSE`: å£°æ˜ç«¯å£ï¼ˆé—¨ç‰Œå·ï¼‰
- `ENV`: è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæˆ¿å±‹é…ç½®ï¼‰

---

### 2. é•œåƒ (Image) = é¢„åˆ¶æˆ¿å±‹æ¨¡å—

**å®šä¹‰**: æ ¹æ® Dockerfile æ„å»ºå‡ºçš„åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚

**æˆ¿å±‹æ¯”å–»**: åœ¨å·¥å‚æŒ‰å›¾çº¸é¢„åˆ¶å¥½çš„æ ‡å‡†åŒ–æˆ¿å±‹æ¨¡å—ï¼Œåƒä¹é«˜ç§¯æœ¨ä¸€æ ·å¯ä»¥å¿«é€Ÿç»„è£…ã€‚

**æ„å»ºé•œåƒ**:
```bash
# åŸºæœ¬æ„å»º
docker build -t my-app .

# æŒ‡å®š Dockerfile
docker build -f Dockerfile.dev -t my-app-dev .

# ä¸ä½¿ç”¨ç¼“å­˜
docker build --no-cache -t my-app .
```

**ç‰¹ç‚¹**:
- ğŸ“¦ åœ¨å·¥å‚é¢„åˆ¶å®Œæˆï¼Œè´¨é‡ç»Ÿä¸€
- ğŸ­ å¯ä»¥æ‰¹é‡ç”Ÿäº§
- ğŸšš å¯ä»¥è¿è¾“åˆ°ä»»ä½•åœ°æ–¹ï¼ˆDocker Hubï¼‰
- ğŸ”’ åªè¯»çš„ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹
- â™¾ï¸ ä¸€å¥—æ¨¡å—å¯ä»¥å¤åˆ¶æ— æ•°å¥—

**é•œåƒåˆ†å±‚**:
```
é•œåƒ = å¤šå±‚å åŠ 
â”œâ”€â”€ Layer 1: åŸºç¡€ç³»ç»Ÿï¼ˆåœ°åŸºï¼‰
â”œâ”€â”€ Layer 2: è¿è¡Œæ—¶ç¯å¢ƒï¼ˆæ¡†æ¶ï¼‰
â”œâ”€â”€ Layer 3: ä¾èµ–åŒ…ï¼ˆè®¾å¤‡ï¼‰
â””â”€â”€ Layer 4: åº”ç”¨ä»£ç ï¼ˆè£…ä¿®ï¼‰
```

**å¸¸ç”¨å‘½ä»¤**:
```bash
# æŸ¥çœ‹é•œåƒåˆ—è¡¨
docker images

# åˆ é™¤é•œåƒ
docker rmi é•œåƒåç§°

# ä¸‹è½½é•œåƒ
docker pull é•œåƒåç§°

# æŸ¥çœ‹é•œåƒè¯¦æƒ…
docker inspect é•œåƒåç§°

# æŸ¥çœ‹é•œåƒæ„å»ºå†å²
docker history é•œåƒåç§°
```

---

### 3. å®¹å™¨ (Container) = å®é™…å»ºæˆçš„æˆ¿å±‹

**å®šä¹‰**: é•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œæ˜¯åº”ç”¨å®é™…è¿è¡Œçš„ç¯å¢ƒã€‚

**æˆ¿å±‹æ¯”å–»**: ç”¨é¢„åˆ¶æ¨¡å—åœ¨å·¥åœ°ä¸Šå®é™…ç»„è£…å»ºæˆçš„æˆ¿å±‹ï¼Œå¯ä»¥å…¥ä½ä½¿ç”¨ã€‚

**åˆ›å»ºå’Œè¿è¡Œå®¹å™¨**:
```bash
# åŸºæœ¬è¿è¡Œ
docker run my-app

# åå°è¿è¡Œ
docker run -d my-app

# æŒ‡å®šåç§°å’Œç«¯å£
docker run -d --name my-container -p 8000:8000 my-app

# æŒ‚è½½å·
docker run -d -v ./data:/app/data my-app

# è®¾ç½®ç¯å¢ƒå˜é‡
docker run -d -e DEBUG=true my-app
```

**ç‰¹ç‚¹**:
- ğŸ¡ çœŸå®è¿è¡Œçš„ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨
- ğŸšª æœ‰ç‹¬ç«‹çš„ ID å’Œåç§°ï¼ˆé—¨ç‰Œå·ï¼‰
- ğŸ”§ å¯ä»¥ä¿®æ”¹å†…éƒ¨å†…å®¹ï¼ˆä½†é‡å¯åæ¢å¤ï¼‰
- ğŸ”„ å¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯
- ğŸ—‘ï¸ å¯ä»¥åˆ é™¤

**é•œåƒä¸å®¹å™¨çš„å…³ç³»**:
```
ğŸ“¦ é•œåƒï¼ˆæ¨¡æ¿ï¼‰          ğŸ  å®¹å™¨ï¼ˆå®ä¾‹ï¼‰
   my-app-image    â†’    container-1
                   â†’    container-2
                   â†’    container-3

ä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨
ä¸€ä¸ªå®¹å™¨åªèƒ½ä»ä¸€ä¸ªé•œåƒåˆ›å»º
```

**ç±»æ¯”**:
- **é•œåƒ** = æ¸¸æˆå®‰è£…åŒ…ï¼ˆåªæœ‰ä¸€ä¸ªï¼‰
- **å®¹å™¨** = æ¸¸æˆè¿è¡Œçª—å£ï¼ˆå¯ä»¥å¼€å¤šä¸ªï¼‰

**å¸¸ç”¨å‘½ä»¤**:
```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# å¯åŠ¨/åœæ­¢/é‡å¯å®¹å™¨
docker start å®¹å™¨åç§°
docker stop å®¹å™¨åç§°
docker restart å®¹å™¨åç§°

# åˆ é™¤å®¹å™¨
docker rm å®¹å™¨åç§°

# æŸ¥çœ‹æ—¥å¿—
docker logs å®¹å™¨åç§°
docker logs -f å®¹å™¨åç§°  # å®æ—¶æŸ¥çœ‹

# è¿›å…¥å®¹å™¨
docker exec -it å®¹å™¨åç§° /bin/bash

# æŸ¥çœ‹å®¹å™¨è¯¦æƒ…
docker inspect å®¹å™¨åç§°

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats å®¹å™¨åç§°
```

---

### 4. Docker Compose = å°åŒºæ€»ä½“è§„åˆ’

**å®šä¹‰**: ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨çš„å·¥å…·ã€‚

**æˆ¿å±‹æ¯”å–»**: æ•´ä¸ªä½å®…å°åŒºçš„æ€»ä½“è§„åˆ’å›¾ï¼Œç®¡ç†å¤šæ ‹å»ºç­‘çš„ååŒå·¥ä½œã€‚

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**:
```yaml
# docker-compose.yml
version: '3.8'

services:
  # ä¸»åŠå…¬æ¥¼
  backend:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"
    volumes:
      - .:/app
    environment:
      - DEBUG=true
    networks:
      - app-network
    depends_on:
      - redis
  
  # ä»“å‚¨é…å¥—æ¥¼
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - app-network

# åŸºç¡€è®¾æ–½
volumes:
  redis_data:

networks:
  app-network:
    driver: bridge
```

**ç‰¹ç‚¹**:
- ğŸ˜ï¸ ç®¡ç†å¤šä¸ªå®¹å™¨ï¼ˆå¤šæ ‹å»ºç­‘ï¼‰
- ğŸ“‹ ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰æ‰€æœ‰æœåŠ¡
- ğŸ”„ ä¸€é”®å¯åŠ¨/åœæ­¢æ‰€æœ‰æœåŠ¡
- ğŸ›£ï¸ è‡ªåŠ¨åˆ›å»ºç½‘ç»œè¿æ¥
- ğŸ“¦ è‡ªåŠ¨ç®¡ç†å·å’Œä¾èµ–

**å¸¸ç”¨å‘½ä»¤**:
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æ‰§è¡Œå‘½ä»¤
docker-compose exec æœåŠ¡å å‘½ä»¤
```

---

### 5. å· (Volume) = ä¿é™©ç®±å®¤

**å®šä¹‰**: ç”¨äºæŒä¹…åŒ–å­˜å‚¨æ•°æ®çš„æœºåˆ¶ï¼Œç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸã€‚

**æˆ¿å±‹æ¯”å–»**: å°åŒºçš„ç‹¬ç«‹ä¿é™©ç®±å®¤ï¼Œå³ä½¿æˆ¿å­æ‹†äº†ï¼Œä¿é™©ç®±é‡Œçš„è´µé‡ç‰©å“è¿˜åœ¨ã€‚

**å·çš„ç±»å‹**:

**1. å‘½åå· (Named Volume)**
```yaml
volumes:
  - redis_data:/data  # Docker ç®¡ç†çš„ç‹¬ç«‹å­˜å‚¨
```
**æ¯”å–»**: å°åŒºç»Ÿä¸€ç®¡ç†çš„ä¿é™©ç®±å®¤

**2. ç»‘å®šæŒ‚è½½ (Bind Mount)**
```yaml
volumes:
  - ./logs:/app/logs  # ç›´æ¥æ˜ å°„åˆ°ä¸»æœºç›®å½•
```
**æ¯”å–»**: ç›´è¿ä½ å®¶ä»“åº“çš„é€šé“

**3. ä¸´æ—¶å· (tmpfs)**
```yaml
tmpfs:
  - /tmp  # å†…å­˜ä¸­çš„ä¸´æ—¶å­˜å‚¨
```
**æ¯”å–»**: ä¸´æ—¶å‚¨ç‰©æŸœï¼Œå…³é—¨å°±æ¸…ç©º

**ç‰¹ç‚¹**:
- ğŸ’¾ æ•°æ®æŒä¹…åŒ–ï¼Œå®¹å™¨åˆ é™¤åæ•°æ®ä¸ä¸¢å¤±
- ğŸ”„ å¯ä»¥åœ¨å¤šä¸ªå®¹å™¨é—´å…±äº«
- ğŸ“‚ ç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸ
- ğŸš€ æ€§èƒ½ä¼˜äºç»‘å®šæŒ‚è½½

**å¸¸ç”¨å‘½ä»¤**:
```bash
# åˆ›å»ºå·
docker volume create my-volume

# æŸ¥çœ‹å·åˆ—è¡¨
docker volume ls

# æŸ¥çœ‹å·è¯¦æƒ…
docker volume inspect my-volume

# åˆ é™¤å·
docker volume rm my-volume

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune
```

---

### 6. ç½‘ç»œ (Network) = å°åŒºé“è·¯ç³»ç»Ÿ

**å®šä¹‰**: å®¹å™¨ä¹‹é—´é€šä¿¡çš„ç½‘ç»œå±‚ã€‚

**æˆ¿å±‹æ¯”å–»**: å°åŒºå†…éƒ¨çš„é“è·¯ç³»ç»Ÿï¼Œè®©å»ºç­‘ä¹‹é—´å¯ä»¥äº’ç›¸è®¿é—®ã€‚

**ç½‘ç»œç±»å‹**:

**1. Bridgeï¼ˆæ¡¥æ¥ç½‘ç»œï¼‰**
```bash
docker network create my-network
```
**æ¯”å–»**: å°åŒºå†…éƒ¨é“è·¯ï¼Œå®¹å™¨é—´å¯ä»¥äº’ç›¸è®¿é—®
**ç”¨é€”**: é»˜è®¤ç½‘ç»œç±»å‹ï¼Œé€‚åˆå•ä¸»æœºå¤šå®¹å™¨

**2. Hostï¼ˆä¸»æœºç½‘ç»œï¼‰**
```bash
docker run --network host my-app
```
**æ¯”å–»**: ç›´æ¥ä½¿ç”¨å¤–éƒ¨è¡—é“ï¼Œæ²¡æœ‰éš”ç¦»
**ç”¨é€”**: å®¹å™¨ç›´æ¥ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œæ€§èƒ½æœ€å¥½

**3. Noneï¼ˆæ— ç½‘ç»œï¼‰**
```bash
docker run --network none my-app
```
**æ¯”å–»**: å®Œå…¨å°é—­çš„å»ºç­‘ï¼Œæ²¡æœ‰é“è·¯è¿æ¥
**ç”¨é€”**: å®Œå…¨éš”ç¦»çš„å®¹å™¨

**ç½‘ç»œé€šä¿¡**:
```
å°åŒºå†…éƒ¨é€šä¿¡ï¼ˆå®¹å™¨é—´ï¼‰:
  backend â”€â”€é“è·¯â”€â”€â†’ redis
  å¯ä»¥ç”¨æœåŠ¡åè®¿é—®: redis:6379

å°åŒºå¤–éƒ¨è®¿é—®ï¼ˆä¸»æœºåˆ°å®¹å™¨ï¼‰:
  localhost:8000 â”€â”€å¤§é—¨â”€â”€â†’ backend
  éœ€è¦é€šè¿‡ç«¯å£æ˜ å°„
```

**å¸¸ç”¨å‘½ä»¤**:
```bash
# åˆ›å»ºç½‘ç»œ
docker network create my-network

# æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨
docker network ls

# æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…
docker network inspect my-network

# è¿æ¥å®¹å™¨åˆ°ç½‘ç»œ
docker network connect my-network å®¹å™¨åç§°

# æ–­å¼€è¿æ¥
docker network disconnect my-network å®¹å™¨åç§°

# åˆ é™¤ç½‘ç»œ
docker network rm my-network
```

---

### 7. ç«¯å£æ˜ å°„ = é—¨ç‰Œå·ç³»ç»Ÿ

**å®šä¹‰**: å°†å®¹å™¨å†…éƒ¨ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£ï¼Œä½¿å¤–éƒ¨å¯ä»¥è®¿é—®ã€‚

**æˆ¿å±‹æ¯”å–»**: å°åŒºå†…éƒ¨æœ‰è‡ªå·±çš„é—¨ç‰Œå·ï¼Œéœ€è¦æ˜ å°„åˆ°å¤–éƒ¨è¡—é“æ‰èƒ½è®©è®¿å®¢æ‰¾åˆ°ã€‚

**ç«¯å£æ˜ å°„è¯­æ³•**:
```bash
# -p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
docker run -p 8000:8000 my-app

# æ˜ å°„åˆ°éšæœºç«¯å£
docker run -P my-app

# æŒ‡å®š IP
docker run -p 127.0.0.1:8000:8000 my-app

# å¤šä¸ªç«¯å£
docker run -p 8000:8000 -p 6379:6379 my-app
```

**æ˜ å°„ç¤ºä¾‹**:
```
å¤–éƒ¨è¡—é“ï¼ˆä¸»æœºï¼‰         å°åŒºå†…éƒ¨ï¼ˆå®¹å™¨ï¼‰
localhost:8000    â†’     å®¹å™¨:8000
localhost:3000    â†’     å®¹å™¨:3000
localhost:6379    â†’     å®¹å™¨:6379
```

**æŸ¥çœ‹ç«¯å£æ˜ å°„**:
```bash
# æŸ¥çœ‹å®¹å™¨ç«¯å£
docker port å®¹å™¨åç§°

# è¾“å‡ºç¤ºä¾‹:
# 8000/tcp -> 0.0.0.0:8000
```

---

## ğŸ”„ Docker å·¥ä½œæµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
1. ç¼–å†™ Dockerfileï¼ˆç»˜åˆ¶å›¾çº¸ï¼‰
   â†“
2. docker buildï¼ˆå·¥å‚ç”Ÿäº§é¢„åˆ¶æ¨¡å—ï¼‰
   â†“
3. é•œåƒ Imageï¼ˆé¢„åˆ¶æ¨¡å—å…¥åº“ï¼‰
   â†“
4. docker runï¼ˆç”¨æ¨¡å—ç»„è£…æˆ¿å±‹ï¼‰
   â†“
5. å®¹å™¨ Containerï¼ˆæˆ¿å±‹å¼€å§‹è¿è¥ï¼‰
   â†“
6. docker stopï¼ˆå…³é—­æˆ¿å±‹ï¼‰
   â†“
7. docker rmï¼ˆæ‹†é™¤æˆ¿å±‹ï¼‰
```

### å®é™…å¼€å‘æµç¨‹

```bash
# 1. ç¼–å†™ Dockerfile
vim Dockerfile

# 2. æ„å»ºé•œåƒ
docker build -t my-app:v1.0 .

# 3. è¿è¡Œå®¹å™¨
docker run -d --name my-container -p 8000:8000 my-app:v1.0

# 4. æŸ¥çœ‹æ—¥å¿—
docker logs -f my-container

# 5. è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it my-container /bin/bash

# 6. åœæ­¢å®¹å™¨
docker stop my-container

# 7. åˆ é™¤å®¹å™¨
docker rm my-container

# 8. åˆ é™¤é•œåƒ
docker rmi my-app:v1.0
```

---

## ğŸ¯ Docker vs ä¼ ç»Ÿéƒ¨ç½²

### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
å¼€å‘ç¯å¢ƒ:
  Python 3.9 + ä¾èµ–Aç‰ˆæœ¬1.0
  â†“
æµ‹è¯•ç¯å¢ƒ:
  Python 3.10 + ä¾èµ–Aç‰ˆæœ¬1.5
  â†“
ç”Ÿäº§ç¯å¢ƒ:
  Python 3.11 + ä¾èµ–Aç‰ˆæœ¬2.0

ç»“æœ: ğŸ˜± "åœ¨æˆ‘ç”µè„‘ä¸Šèƒ½è·‘å•Šï¼"
```

### Docker çš„è§£å†³æ–¹æ¡ˆ

```
æ‰€æœ‰ç¯å¢ƒ:
  Docker å®¹å™¨ï¼ˆPython 3.11 + å›ºå®šä¾èµ–ï¼‰
  â†“
  å®Œå…¨ç›¸åŒçš„è¿è¡Œç¯å¢ƒ

ç»“æœ: ğŸ˜Š "åˆ°å¤„éƒ½èƒ½è·‘ï¼"
```

### ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿéƒ¨ç½² | Docker éƒ¨ç½² |
|------|---------|------------|
| ç¯å¢ƒä¸€è‡´æ€§ | âŒ éš¾ä»¥ä¿è¯ | âœ… å®Œå…¨ä¸€è‡´ |
| ä¾èµ–ç®¡ç† | âŒ å®¹æ˜“å†²çª | âœ… å®Œå…¨éš”ç¦» |
| å¯åŠ¨é€Ÿåº¦ | â° éœ€è¦é…ç½®ç¯å¢ƒ | âš¡ ç§’çº§å¯åŠ¨ |
| èµ„æºå ç”¨ | ğŸ’» ç›´æ¥å ç”¨ä¸»æœº | ğŸ“¦ è½»é‡çº§éš”ç¦» |
| å¯ç§»æ¤æ€§ | âŒ ä¾èµ–ä¸»æœºç¯å¢ƒ | âœ… åˆ°å¤„å¯è¿è¡Œ |
| ç‰ˆæœ¬å›æ»š | âŒ å›°éš¾ | âœ… ç®€å• |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. Dockerfile ç¼–å†™

**âœ… æ¨èåšæ³•**:
```dockerfile
# ä½¿ç”¨å®˜æ–¹åŸºç¡€é•œåƒ
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY requirements.txt .
RUN pip install -r requirements.txt

# å†å¤åˆ¶ä»£ç ï¼ˆä»£ç å˜åŒ–é¢‘ç¹ï¼‰
COPY . .

# ä½¿ç”¨é root ç”¨æˆ·
RUN useradd -m appuser
USER appuser

# å£°æ˜ç«¯å£
EXPOSE 8000

# ä½¿ç”¨ exec å½¢å¼çš„ CMD
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0"]
```

**âŒ é¿å…åšæ³•**:
```dockerfile
# ä¸è¦ä½¿ç”¨ latest æ ‡ç­¾
FROM python:latest  # âŒ

# ä¸è¦åœ¨ä¸€å±‚åšå¤ªå¤šäº‹
RUN apt-get update && apt-get install -y \
    package1 package2 package3 ...  # âŒ

# ä¸è¦å¤åˆ¶ä¸å¿…è¦çš„æ–‡ä»¶
COPY . .  # åº”è¯¥ä½¿ç”¨ .dockerignore
```

### 2. é•œåƒä¼˜åŒ–

**å‡å°é•œåƒå¤§å°**:
```dockerfile
# ä½¿ç”¨å¤šé˜¶æ®µæ„å»º
FROM python:3.11 as builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
ENV PATH=/root/.local/bin:$PATH
CMD ["uvicorn", "app.main:app"]
```

**ä½¿ç”¨ .dockerignore**:
```
# .dockerignore
__pycache__/
*.pyc
.git/
.env
node_modules/
*.log
```

### 3. å®¹å™¨ç®¡ç†

**å‘½åè§„èŒƒ**:
```bash
# ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
docker run --name backend-api my-app  # âœ…
docker run --name abc123 my-app       # âŒ

# ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç‰ˆæœ¬
docker build -t my-app:v1.0.0 .       # âœ…
docker build -t my-app .              # âŒ
```

**èµ„æºé™åˆ¶**:
```bash
# é™åˆ¶å†…å­˜å’Œ CPU
docker run -d \
  --memory="512m" \
  --cpus="1.0" \
  my-app
```

### 4. æ•°æ®ç®¡ç†

**ä½¿ç”¨å·è€Œä¸æ˜¯ç»‘å®šæŒ‚è½½**:
```yaml
# âœ… æ¨èï¼šä½¿ç”¨å‘½åå·
volumes:
  - app_data:/app/data

# âš ï¸ è°¨æ…ï¼šç»‘å®šæŒ‚è½½ï¼ˆå¼€å‘ç¯å¢ƒå¯ç”¨ï¼‰
volumes:
  - ./data:/app/data
```

### 5. å®‰å…¨å®è·µ

```dockerfile
# ä½¿ç”¨é root ç”¨æˆ·
RUN useradd -m -u 1000 appuser
USER appuser

# ä¸è¦åœ¨é•œåƒä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯
# âŒ ENV SECRET_KEY=abc123
# âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å·¥å…·

# å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
FROM python:3.11-slim  # å®šæœŸæ£€æŸ¥æ›´æ–°
```

---

## ğŸ§¹ æ¸…ç†å’Œç»´æŠ¤

### å®šæœŸæ¸…ç†

```bash
# æ¸…ç†åœæ­¢çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune

# æ¸…ç†æœªä½¿ç”¨çš„ç½‘ç»œ
docker network prune

# ä¸€é”®æ¸…ç†æ‰€æœ‰
docker system prune -a

# æŸ¥çœ‹å ç”¨ç©ºé—´
docker system df
```

### ç›‘æ§å’Œè°ƒè¯•

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹å®¹å™¨è¿›ç¨‹
docker top å®¹å™¨åç§°

# æŸ¥çœ‹å®¹å™¨å˜åŒ–
docker diff å®¹å™¨åç§°

# å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿ
docker export å®¹å™¨åç§° > container.tar

# ä¿å­˜é•œåƒ
docker save my-app > my-app.tar

# åŠ è½½é•œåƒ
docker load < my-app.tar
```

---

## ğŸ“š è¿›é˜¶ä¸»é¢˜

### 1. å¤šé˜¶æ®µæ„å»º

å‡å°æœ€ç»ˆé•œåƒå¤§å°ï¼š
```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18 as builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# è¿è¡Œé˜¶æ®µ
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
CMD ["node", "dist/main.js"]
```

### 2. å¥åº·æ£€æŸ¥

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1
```

### 3. æ„å»ºå‚æ•°

```dockerfile
ARG NODE_VERSION=18
FROM node:${NODE_VERSION}

ARG BUILD_DATE
LABEL build_date=${BUILD_DATE}
```

```bash
docker build --build-arg NODE_VERSION=20 -t my-app .
```

### 4. Docker Compose é«˜çº§ç”¨æ³•

```yaml
services:
  backend:
    build:
      context: .
      args:
        - BUILD_DATE=${BUILD_DATE}
    depends_on:
      redis:
        condition: service_healthy
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Dockerfile å‚è€ƒ](https://docs.docker.com/engine/reference/builder/)

### é¡¹ç›®ç›¸å…³æ–‡æ¡£
- [agent-backend/docker/README.md](../agent-backend/docker/README.md) - é¡¹ç›® Docker é…ç½®è¯¦è§£
- [backend-setup.md](./backend-setup.md) - åç«¯æŠ€æœ¯æ¶æ„
- [scripts/startup/README.md](../scripts/startup/README.md) - å¯åŠ¨è„šæœ¬è¯´æ˜

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µè®°å¿†

| æ¦‚å¿µ | æˆ¿å±‹æ¯”å–» | ä¸€å¥è¯æ€»ç»“ |
|------|----------|-----------|
| **Dockerfile** | å»ºç­‘å›¾çº¸ | å®šä¹‰å¦‚ä½•æ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ |
| **é•œåƒ** | é¢„åˆ¶æ¨¡å— | åªè¯»çš„åº”ç”¨æ¨¡æ¿ï¼Œå¯åˆ›å»ºå¤šä¸ªå®¹å™¨ |
| **å®¹å™¨** | å®é™…æˆ¿å±‹ | é•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œåº”ç”¨å®é™…è¿è¡Œçš„åœ°æ–¹ |
| **Docker Compose** | å°åŒºè§„åˆ’ | ç®¡ç†å¤šå®¹å™¨åº”ç”¨çš„å·¥å…· |
| **å·** | ä¿é™©ç®±å®¤ | æŒä¹…åŒ–æ•°æ®å­˜å‚¨ |
| **ç½‘ç»œ** | é“è·¯ç³»ç»Ÿ | å®¹å™¨é—´é€šä¿¡é€šé“ |
| **ç«¯å£æ˜ å°„** | é—¨ç‰Œå· | å¤–éƒ¨è®¿é—®å®¹å™¨çš„å…¥å£ |

### å…³é”®ç†è§£

1. **é•œåƒ â†’ å®¹å™¨**: ä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨
2. **å®¹å™¨ â† é•œåƒ**: ä¸€ä¸ªå®¹å™¨åªèƒ½ä»ä¸€ä¸ªé•œåƒåˆ›å»º
3. **Dockerfile â†’ é•œåƒ**: å›¾çº¸ç”¨æ¥ç”Ÿäº§æ¨¡å—
4. **é•œåƒ â†’ å®¹å™¨**: æ¨¡å—ç”¨æ¥ç»„è£…æˆ¿å±‹

### ä¸‹ä¸€æ­¥

- ğŸš€ å®è·µï¼šå°è¯•ç¼–å†™è‡ªå·±çš„ Dockerfile
- ğŸ“– æ·±å…¥ï¼šå­¦ä¹  Docker Compose ç¼–æ’
- ğŸ”§ ä¼˜åŒ–ï¼šæŒæ¡é•œåƒä¼˜åŒ–æŠ€å·§
- ğŸ›¡ï¸ å®‰å…¨ï¼šäº†è§£ Docker å®‰å…¨æœ€ä½³å®è·µ

Docker è®©åº”ç”¨éƒ¨ç½²å˜å¾—ç®€å•ã€ä¸€è‡´ã€å¯é ã€‚æŒæ¡è¿™äº›æ ¸å¿ƒæ¦‚å¿µï¼Œä½ å°±èƒ½å……åˆ†åˆ©ç”¨å®¹å™¨åŒ–æŠ€æœ¯çš„ä¼˜åŠ¿ï¼ğŸ‰
